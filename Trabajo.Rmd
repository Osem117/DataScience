---
title: "League of Legends Games"
output: html_notebook
---

## Instalación e importación de las librerías necesarias.

```{r}
#install.packages("plyr")
#install.packages("dplyr")
#install.packages("RJSONIO")
#install.packages("factoextra")
#install.packages("party")
#install.packages("caTools")

library(plyr)
library(dplyr)
library(RJSONIO)
library(ggplot2)
library(cluster)
library(factoextra)
library(party)
library(caTools)
library(scales)
```

## Lectura de datasets. (Alicia)

* Cargamos los datos del fichero csv con la información sobre las partidas en la variable "lol".
* Cargamos los datos del fichero csv que contiene la correspondencia entre los nombres de los campeones y sus IDs en la variable "champions".
* Cargamos los datos del fichero JSON que contiene la correspondencia entre los nombres de los hechizos y sus IDs en la variable "summoners".

```{r}
# Lectura
lol <- read.csv("./lolData/games.csv")
champions <- read.csv("./lolData/champs.csv")
con <- file("./lolData/summoner_spell_info.json", "r")

# Conversión a data frames
df_games = data.frame(lol)
head(df_games)

df_champs = data.frame(champions)
head(df_champs)

df_summoners <- ldply(fromJSON(con), data.frame)
close(con)
head(df_summoners)
```

## Limpieza de datasets. (Alicia)

* Eliminar los atributos que no sean relevantes para nuestro análisis:

  Para el dataframe de partidas (df_games):
  - El ID de las partidas.
  - La temporada en la que se jugó la partida, ya que todos nuestros datos son de la temporada 9.
  - La fecha de inicio de la partida, que no es relevante en comparación con otros datos como la duración de la partida y además sabemos que todas las partidas se jugaron durante el mismo año ya que pertenecen a la misma temporada.


  Para el dataframe de hechizos (df_summonners):
  - Eliminamos todas las columnas excepto las que contienen el nombre del hechizo y su ID para poder realizar la transformación en el dataframe de partidas más adelante.

```{r}
# Dataframe de partidas
df_games$gameId <- NULL # ID de la partida
df_games$seasonId <- NULL # ID de la temporada en la que se juega la partida
df_games$creationTime <- NULL # Fecha de creación de la partida
head(df_games)

# Dataframe de hechizos
df_summoners$.id <- NULL # ID (duplicado) del hechizo
df_summoners$summonerLevel <- NULL # Nivel en el que se desbloquea el hechizo para el jugador
df_summoners$key <- NULL # Nombre de la variable interna que representa al hechizo
df_summoners$description <- NULL # Descripción de la funcionalidad del hechizo dentro del juego
head(df_summoners)
```

* Eliminar los ejemplos de partidas cuya duración es menor a 15 minutos. Esto quiere decir que la partida ha finalizado por razones fuera de lo normal, por ejemplo, que algún jugador no esté conectado:

```{r}
df_games <- df_games[!(df_games$gameDuration < 900),]
head(df_games[order(df_games$gameDuration),])
```

* Sustituir el orden numérico atribuido a los equipos (0, 1, 2) por una etiqueta que lo represente ("none", "blue", "red") en todas aquellos atributos cuyo valor sea uno de los dos equipos.

```{r}
# Ganador de la partida
df_games$winner[df_games$winner == "0"] <- "none"
df_games$winner[df_games$winner == "1"] <- "blue"
df_games$winner[df_games$winner == "2"] <- "red"

# Equipo que consigue eliminar a un jugador del equipo contrario primero (esto conlleva una recompensa extra dentro del juego)
df_games$firstBlood[df_games$firstBlood == "0"] <- "none"
df_games$firstBlood[df_games$firstBlood == "1"] <- "blue"
df_games$firstBlood[df_games$firstBlood == "2"] <- "red"

# Equipo que consigue derrumbar una torre del equipo contrario primero (esto conlleva una recompensa extra dentro del juego)
df_games$firstTower[df_games$firstTower == "0"] <- "none"
df_games$firstTower[df_games$firstTower == "1"] <- "blue"
df_games$firstTower[df_games$firstTower == "2"] <- "red"

# Equipo que consigue derrumbar un inhibidor del equipo contrario primero (los inhibidores se encuentran muy cerca de la estructura final que hay que derrumbar para terminar la partida)
df_games$firstInhibitor[df_games$firstInhibitor == "0"] <- "none"
df_games$firstInhibitor[df_games$firstInhibitor == "1"] <- "blue"
df_games$firstInhibitor[df_games$firstInhibitor == "2"] <- "red"

# Equipo que consigue eliminar primero al monstruo de la jungla denominado como Baron (este monstruo otorga una gran mejora de estadísticas al equipo que lo haya eliminado)
df_games$firstBaron[df_games$firstBaron == "0"] <- "none"
df_games$firstBaron[df_games$firstBaron == "1"] <- "blue"
df_games$firstBaron[df_games$firstBaron == "2"] <- "red"

# Equipo que consigue eliminar primero a alguno de los dragones que aparecen (estos monstruos otorgan pequeñas mejoras de estadísiticas al equipo que los haya eliminado)
df_games$firstDragon[df_games$firstDragon == "0"] <- "none"
df_games$firstDragon[df_games$firstDragon == "1"] <- "blue"
df_games$firstDragon[df_games$firstDragon == "2"] <- "red"

# Equipo que consigue eliminar al monstruo de la jungla denominado como Heraldo (solo aparece 1 durante la partida y ayuda al equipo que lo haya eliminado a derrumbar estructuras tales como torres e inhibidores)
df_games$firstRiftHerald[df_games$firstRiftHerald == "0"] <- "none"
df_games$firstRiftHerald[df_games$firstRiftHerald == "1"] <- "blue"
df_games$firstRiftHerald[df_games$firstRiftHerald == "2"] <- "red"

head(df_games)
```

```{r}
#Para posterior manipulación de clustering sin cambiar id -> nombre
dfClus = df_games
```

* Sustituir el identificador numérico de los campeones seleccionados y baneados por cada uno de los jugadores de ambos equipos por el nombre del campeón en el juego:
  En este caso utilizamos los datos del dataframe de campeones (df_champs) para reemplazar los datos del dataframe de partidas (df_games). Para realizar cada uno de los reemplazos en cada una de las columnas del dataframe de partidas que lo requieren, renombramos la columna del dataframe de campeones que contiene el ID del campeón para que coincida con el nombre de la columna cuyos ID queremos reemplazar en el dataframe de partidas. Además, renombramos la columna del dataframe de campeones que contiene el nombre del campeón por el nombre que queramos que tenga dicha columna en el dataframe de partidas. A continuación, realizamos un left join de ambos datasets a través de la columna de IDs que queremos sustituir y que ahora se llama igual en ambos dataframes. De esta manera, añadirá una nueva columna con los nombres de los campeones a partir de su ID según los datos en el dataframe de campeones. Finalmente, eliminamos la anterior columna que contenía los IDs y queríamos sustituir.

```{r}
# Campeón utilizado por el jugador 1 del equipo azul
df_champs = rename(df_champs, t1_champ1id = 'id') # (1) Renombramos la columna de IDs del dataframe de campeones por el nombre de la columna que queremos sustituir en el dataframe de partidas
df_champs = rename(df_champs, t1_champ1Name = 'name') # (2) Renombramos la columna de nombres del dataframe de campeones por el nombre que queramos que tenga la nueva columna de nombres en el dataframe de partidas

df_games <- left_join(df_games, df_champs, by = 't1_champ1id') # (3) Realizamos un left join entre ambos datasets a través de la columna que ahora se llama igual en ambos dataframes y que queremos sustituir (columnas que contienen IDs). Esto resultará en la adición de una nueva columna nombrada como hayamos decidido en el paso 2 y que contiene el nombre de cada campeón según su ID.
df_games$t1_champ1id <- NULL # (4) Eliminamos la columna que contiene los IDs de los campeones que queríamos sustituir en un primer momento.

# Campeón utilizado por el jugador 2 del equipo azul
df_champs = rename(df_champs, t1_champ2id = 't1_champ1id')
df_champs = rename(df_champs, t1_champ2Name = 't1_champ1Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ2id')
df_games$t1_champ2id <- NULL

# Campeón utilizado por el jugador 3 del equipo azul
df_champs = rename(df_champs, t1_champ3id = 't1_champ2id')
df_champs = rename(df_champs, t1_champ3Name = 't1_champ2Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ3id')
df_games$t1_champ3id <- NULL

# Campeón utilizado por el jugador 4 del equipo azul
df_champs = rename(df_champs, t1_champ4id = 't1_champ3id')
df_champs = rename(df_champs, t1_champ4Name = 't1_champ3Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ4id')
df_games$t1_champ4id <- NULL

# Campeón utilizado por el jugador 5 del equipo azul
df_champs = rename(df_champs, t1_champ5id = 't1_champ4id')
df_champs = rename(df_champs, t1_champ5Name = 't1_champ4Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ5id')
df_games$t1_champ5id <- NULL

# Campeón baneado por el jugador 1 del equipo azul
df_champs = rename(df_champs, t1_ban1 = 't1_champ5id')
df_champs = rename(df_champs, t1_banName1 = 't1_champ5Name')

df_games <- left_join(df_games, df_champs, by = 't1_ban1')
df_games$t1_ban1 <- NULL

# Campeón baneado por el jugador 2 del equipo azul
df_champs = rename(df_champs, t1_ban2 = 't1_ban1')
df_champs = rename(df_champs, t1_banName2 = 't1_banName1')

df_games <- left_join(df_games, df_champs, by = 't1_ban2')
df_games$t1_ban2 <- NULL

# Campeón baneado por el jugador 3 del equipo azul
df_champs = rename(df_champs, t1_ban3 = 't1_ban2')
df_champs = rename(df_champs, t1_banName3 = 't1_banName2')

df_games <- left_join(df_games, df_champs, by = 't1_ban3')
df_games$t1_ban3 <- NULL

# Campeón baneado por el jugador 4 del equipo azul
df_champs = rename(df_champs, t1_ban4 = 't1_ban3')
df_champs = rename(df_champs, t1_banName4 = 't1_banName3')

df_games <- left_join(df_games, df_champs, by = 't1_ban4')
df_games$t1_ban4 <- NULL

# Campeón baneado por el jugador 5 del equipo azul
df_champs = rename(df_champs, t1_ban5 = 't1_ban4')
df_champs = rename(df_champs, t1_banName5 = 't1_banName4')

df_games <- left_join(df_games, df_champs, by = 't1_ban5')
df_games$t1_ban5 <- NULL

# Campeón utilizado por el jugador 1 del equipo rojo
df_champs = rename(df_champs, t2_champ1id = 't1_ban5')
df_champs = rename(df_champs, t2_champ1Name = 't1_banName5')

df_games <- left_join(df_games, df_champs, by = 't2_champ1id')
df_games$t2_champ1id <- NULL

# Campeón utilizado por el jugador 2 del equipo rojo
df_champs = rename(df_champs, t2_champ2id = 't2_champ1id')
df_champs = rename(df_champs, t2_champ2Name = 't2_champ1Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ2id')
df_games$t2_champ2id <- NULL

# Campeón utilizado por el jugador 3 del equipo rojo
df_champs = rename(df_champs, t2_champ3id = 't2_champ2id')
df_champs = rename(df_champs, t2_champ3Name = 't2_champ2Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ3id')
df_games$t2_champ3id <- NULL

# Campeón utilizado por el jugador 4 del equipo rojo
df_champs = rename(df_champs, t2_champ4id = 't2_champ3id')
df_champs = rename(df_champs, t2_champ4Name = 't2_champ3Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ4id')
df_games$t2_champ4id <- NULL

# Campeón utilizado por el jugador 5 del equipo rojo
df_champs = rename(df_champs, t2_champ5id = 't2_champ4id')
df_champs = rename(df_champs, t2_champ5Name = 't2_champ4Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ5id')
df_games$t2_champ5id <- NULL

# Campeón baneado por el jugador 1 del equipo rojo
df_champs = rename(df_champs, t2_ban1 = 't2_champ5id')
df_champs = rename(df_champs, t2_banName1 = 't2_champ5Name')

df_games <- left_join(df_games, df_champs, by = 't2_ban1')
df_games$t2_ban1 <- NULL

# Campeón baneado por el jugador 2 del equipo rojo
df_champs = rename(df_champs, t2_ban2 = 't2_ban1')
df_champs = rename(df_champs, t2_banName2 = 't2_banName1')

df_games <- left_join(df_games, df_champs, by = 't2_ban2')
df_games$t2_ban2 <- NULL

# Campeón baneado por el jugador 3 del equipo rojo
df_champs = rename(df_champs, t2_ban3 = 't2_ban2')
df_champs = rename(df_champs, t2_banName3 = 't2_banName2')

df_games <- left_join(df_games, df_champs, by = 't2_ban3')
df_games$t2_ban3 <- NULL

# Campeón baneado por el jugador 4 del equipo rojo
df_champs = rename(df_champs, t2_ban4 = 't2_ban3')
df_champs = rename(df_champs, t2_banName4 = 't2_banName3')

df_games <- left_join(df_games, df_champs, by = 't2_ban4')
df_games$t2_ban4 <- NULL

# Campeón baneado por el jugador 5 del equipo rojo
df_champs = rename(df_champs, t2_ban5 = 't2_ban4')
df_champs = rename(df_champs, t2_banName5 = 't2_banName4')

df_games <- left_join(df_games, df_champs, by = 't2_ban5')
df_games$t2_ban5 <- NULL

head(df_games)
```

* Sustituir el identificador numérico de los dos hechizos que cada uno de los jugadores de ambos equipos usarán en la partida por el nombre del hechizo en el juego:
  Seguimos el mismo planteamiento que el paso anterior, esta vez para sustituir los IDs de los hechizos que utilizan los jugadores en el dataframe de partidas (df_games), mediante los datos en el dataset de hechizos (df_summoners). 

```{r}
# Hechizo principal utilizado por el jugador 1 del equipo azul
df_summoners = rename(df_summoners, t1_champ1_sum1 = 'id') # (1) Renombramos la columna de IDs del dataframe de hechizos por el nombre de la columna que queremos sustituir en el dataframe de partidas
df_summoners = rename(df_summoners, t1_champ1_sumName1 = 'name') # (2) Renombramos la columna de nombres del dataframe de hechizos por el nombre que queramos que tenga la nueva columna de nombres en el dataframe de partidas

df_games <- left_join(df_games, df_summoners, by = 't1_champ1_sum1') # (3) Realizamos un left join entre ambos datasets a través de la columna que ahora se llama igual en ambos dataframes y que queremos sustituir (columnas que contienen IDs). Esto resultará en la adición de una nueva columna nombrada como hayamos decidido en el paso 2 y que contiene el nombre de cada hechizo según su ID.
df_games$t1_champ1_sum1 <- NULL # (4) Eliminamos la columna que contiene los IDs de los hechizos que queríamos sustituir en un primer momento.

# Hechizo secundario utilizado por el jugador 1 del equipo azul
df_summoners = rename(df_summoners, t1_champ1_sum2 = 't1_champ1_sum1')
df_summoners = rename(df_summoners, t1_champ1_sumName2 = 't1_champ1_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ1_sum2')
df_games$t1_champ1_sum2 <- NULL

# Hechizo principal utilizado por el jugador 2 del equipo azul
df_summoners = rename(df_summoners, t1_champ2_sum1 = 't1_champ1_sum2')
df_summoners = rename(df_summoners, t1_champ2_sumName1 = 't1_champ1_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ2_sum1')
df_games$t1_champ2_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 2 del equipo azul
df_summoners = rename(df_summoners, t1_champ2_sum2 = 't1_champ2_sum1')
df_summoners = rename(df_summoners, t1_champ2_sumName2 = 't1_champ2_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ2_sum2')
df_games$t1_champ2_sum2 <- NULL

# Hechizo principal utilizado por el jugador 3 del equipo azul
df_summoners = rename(df_summoners, t1_champ3_sum1 = 't1_champ2_sum2')
df_summoners = rename(df_summoners, t1_champ3_sumName1 = 't1_champ2_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ3_sum1')
df_games$t1_champ3_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 3 del equipo azul
df_summoners = rename(df_summoners, t1_champ3_sum2 = 't1_champ3_sum1')
df_summoners = rename(df_summoners, t1_champ3_sumName2 = 't1_champ3_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ3_sum2')
df_games$t1_champ3_sum2 <- NULL

# Hechizo principal utilizado por el jugador 4 del equipo azul
df_summoners = rename(df_summoners, t1_champ4_sum1 = 't1_champ3_sum2')
df_summoners = rename(df_summoners, t1_champ4_sumName1 = 't1_champ3_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ4_sum1')
df_games$t1_champ4_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 4 del equipo azul
df_summoners = rename(df_summoners, t1_champ4_sum2 = 't1_champ4_sum1')
df_summoners = rename(df_summoners, t1_champ4_sumName2 = 't1_champ4_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ4_sum2')
df_games$t1_champ4_sum2 <- NULL

# Hechizo principal utilizado por el jugador 5 del equipo azul
df_summoners = rename(df_summoners, t1_champ5_sum1 = 't1_champ4_sum2')
df_summoners = rename(df_summoners, t1_champ5_sumName1 = 't1_champ4_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ5_sum1')
df_games$t1_champ5_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 5 del equipo azul
df_summoners = rename(df_summoners, t1_champ5_sum2 = 't1_champ5_sum1')
df_summoners = rename(df_summoners, t1_champ5_sumName2 = 't1_champ5_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ5_sum2')
df_games$t1_champ5_sum2 <- NULL

# Hechizo principal utilizado por el jugador 1 del equipo rojo
df_summoners = rename(df_summoners, t2_champ1_sum1 = 't1_champ5_sum2')
df_summoners = rename(df_summoners, t2_champ1_sumName1 = 't1_champ5_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ1_sum1')
df_games$t2_champ1_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 1 del equipo rojo
df_summoners = rename(df_summoners, t2_champ1_sum2 = 't2_champ1_sum1')
df_summoners = rename(df_summoners, t2_champ1_sumName2 = 't2_champ1_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ1_sum2')
df_games$t2_champ1_sum2 <- NULL

# Hechizo principal utilizado por el jugador 2 del equipo rojo
df_summoners = rename(df_summoners, t2_champ2_sum1 = 't2_champ1_sum2')
df_summoners = rename(df_summoners, t2_champ2_sumName1 = 't2_champ1_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ2_sum1')
df_games$t2_champ2_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 2 del equipo rojo
df_summoners = rename(df_summoners, t2_champ2_sum2 = 't2_champ2_sum1')
df_summoners = rename(df_summoners, t2_champ2_sumName2 = 't2_champ2_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ2_sum2')
df_games$t2_champ2_sum2 <- NULL

# Hechizo principal utilizado por el jugador 3 del equipo rojo
df_summoners = rename(df_summoners, t2_champ3_sum1 = 't2_champ2_sum2')
df_summoners = rename(df_summoners, t2_champ3_sumName1 = 't2_champ2_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ3_sum1')
df_games$t2_champ3_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 3 del equipo rojo
df_summoners = rename(df_summoners, t2_champ3_sum2 = 't2_champ3_sum1')
df_summoners = rename(df_summoners, t2_champ3_sumName2 = 't2_champ3_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ3_sum2')
df_games$t2_champ3_sum2 <- NULL

# Hechizo principal utilizado por el jugador 4 del equipo rojo
df_summoners = rename(df_summoners, t2_champ4_sum1 = 't2_champ3_sum2')
df_summoners = rename(df_summoners, t2_champ4_sumName1 = 't2_champ3_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ4_sum1')
df_games$t2_champ4_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 4 del equipo rojo
df_summoners = rename(df_summoners, t2_champ4_sum2 = 't2_champ4_sum1')
df_summoners = rename(df_summoners, t2_champ4_sumName2 = 't2_champ4_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ4_sum2')
df_games$t2_champ4_sum2 <- NULL

# Hechizo principal utilizado por el jugador 5 del equipo rojo
df_summoners = rename(df_summoners, t2_champ5_sum1 = 't2_champ4_sum2')
df_summoners = rename(df_summoners, t2_champ5_sumName1 = 't2_champ4_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ5_sum1')
df_games$t2_champ5_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 5 del equipo rojo
df_summoners = rename(df_summoners, t2_champ5_sum2 = 't2_champ5_sum1')
df_summoners = rename(df_summoners, t2_champ5_sumName2 = 't2_champ5_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ5_sum2')
df_games$t2_champ5_sum2 <- NULL

head(df_games)
```

```{r}
#Variables con los nombres en lugar de los ID 
dfClusName = df_games
dfAR = df_games
df_games_dt = df_games
```

## Predicción del equipo ganador - Decision Trees (Alicia)

Como preprocesado específico de esta sección:
  * Convertimos a factores las columnas cuyo valor es el equipo implicado ("red", "blue", "none"). Este paso es necesario para poder utilizar la técnica de árboles de decisión, que no admite caracteres:
  
```{r}
df_games_dt <- df_games_dt[!(df_games_dt$winner == "none"),] # No existen partidas en las que no gane ningún equipo, pero las eliminamos para asegurarnos
df_games_dt$winner <- factor(df_games_dt$winner, levels = c("red", "blue")) # Equipo ganador

df_games_dt$firstBlood <- factor(df_games_dt$firstBlood, levels = c("red", "blue", "none")) # Equipo que consigue eliminar a un jugador del otro equipo primero
df_games_dt$firstTower <- factor(df_games_dt$firstTower, levels = c("red", "blue", "none")) # Equipo que consigue derribar una torre enemiga primero
df_games_dt$firstInhibitor <- factor(df_games_dt$firstInhibitor, levels = c("red", "blue", "none")) # Equipo que consigue derribar un inhibidor enemigo primero
df_games_dt$firstBaron <- factor(df_games_dt$firstBaron, levels = c("red", "blue", "none")) # Equipo que consigue eliminar al Baron (monstruo neutral) primero
df_games_dt$firstDragon <- factor(df_games_dt$firstDragon, levels = c("red", "blue", "none")) # Equipo que consigue eliminar a un dragón (monstruo neutral) primero
df_games_dt$firstRiftHerald <- factor(df_games_dt$firstRiftHerald, levels = c("red", "blue", "none")) # Equipo que consigue eliminar al Heraldo (monstruo neutral)

head(df_games_dt)
```

  * Dividimos el dataframe en un subconjunto de entrenamiento (df_games_dt_train) y otro de pruebas (df_games_dt_test) que representan el 70% y el 30% de los datos del dataframe original respectivamente:
  
```{r}
set.seed(0) # Semilla para que la distribución aleatoria sea la misma
sample = sample.split(df_games_dt, SplitRatio = 0.70) # División del dataframe

df_games_dt_train = subset(df_games_dt, sample == TRUE) # Dataframe de entrenamiento
head(df_games_dt_train)

df_games_dt_test = subset(df_games_dt, sample == FALSE) # Dataframe de pruebas
head(df_games_dt_test)
```

A continuación, generaremos una serie de modelos de árboles de decisión que posteriormente compararemos para obtener el mejor.

* En primer lugar, generaremos modelos relacionados con los objetivos del juego. Esto son estructuras (torres e inhibidores) y monstruos neutrales (Baron, dragones y Heraldo). El objetivo final de este juego es eliminar el nexo, una que se encuentra en la base enemiga. De camino al nexo se encuentran torres e inhibidores para dificultar la llegada a este. Los monstruos neutrales de la jungla otorgan al equipo que lo elimine una bonificación extra que ayuda tanto a destruir estructuras como a eliminar jugadores enemigos.

  - Árbol de decisión según las estructuras (primera sangre, primera torre y primer inhibidor):

```{r}
tree_structures <- ctree(winner ~ firstBlood + firstTower + firstInhibitor, data = df_games_dt_train) # Entrenamiento del modelo de árbol de decisión
predictions_structures <- predict(tree_structures, df_games_dt_test) # Predicciones sobre el conjunto de pruebas

mean(predictions_structures == df_games_dt_test$winner) # Porcentaje de aciertos

png("tree_structures.png", res = 80, height = 800, width = 1600) # Visualización del árbol de decisión creado en el archivo png que se indica
plot(tree_structures)
```

  - Árbol de decisión según los monstruos neutrales (primer Baron, primer dragón y primer heraldo):
  
```{r}
tree_monsters <- ctree(winner ~ firstBaron + firstDragon + firstRiftHerald, data = df_games_dt_train) # Entrenamiento del modelo de árbol de decisión
predictions_monsters <- predict(tree_monsters, df_games_dt_test) # Predicciones sobre el conjunto de pruebas

mean(predictions_monsters == df_games_dt_test$winner) # Porcentaje de aciertos

png("tree_monsters.png", res = 80, height = 1000, width = 2250) # Visualización del árbol de decisión creado en el archivo png que se indica
plot(tree_monsters)
```

  - Árbol de decisión según el número de Barones que elimina cada equipo:

```{r}
tree_barons <- ctree(winner ~ t1_baronKills + t2_baronKills, data = df_games_dt_train) # Entrenamiento del modelo de árbol de decisión
predictions_barons <- predict(tree_barons, df_games_dt_test) # Predicciones sobre el conjunto de pruebas

mean(predictions_barons == df_games_dt_test$winner) # Porcentaje de aciertos

png("tree_barons.png", res = 80, height = 800, width = 1600) # Visualización del árbol de decisión creado en el archivo png que se indica
plot(tree_barons)
```

  - Árbol de decisión según el número de dragones que elimina cada equipo:
  
```{r}
tree_dragons <- ctree(winner ~ t1_dragonKills + t2_dragonKills, data = df_games_dt_train) # Entrenamiento del modelo de árbol de decisión
predictions_dragons <- predict(tree_dragons, df_games_dt_test) # Predicciones sobre el conjunto de pruebas

mean(predictions_dragons == df_games_dt_test$winner) # Porcentaje de aciertos

png("tree_dragons.png", res = 80, height = 800, width = 1600) # Visualización del árbol de decisión creado en el archivo png que se indica
plot(tree_dragons)
```

  - Árbol de decisión uniendo todo lo utilizado anteriormente:

```{r}
tree_objectives <- ctree(winner ~ firstBlood + firstTower + firstInhibitor + firstBaron + firstDragon + t1_baronKills + t2_baronKills + t1_dragonKills + t2_dragonKills, data = df_games_dt_train) # Entrenamiento del modelo de árbol de decisión
predictions_objectives <- predict(tree_objectives, df_games_dt_test) # Predicciones sobre el conjunto de pruebas

mean(predictions_objectives == df_games_dt_test$winner) # Porcentaje de aciertos

png("tree_objectives.png", res = 80, height = 1000, width = 8000) # Visualización del árbol de decisión creado en el archivo png que se indica
plot(tree_objectives)
```

En este primer subconjunto de modelos vemos cómo existe una gran relación entre sus datos y el ganador de la partida ya que el porcentaje de aciertos supera el 91%. Cabe destacar que el modelo basado en estructuras destaca dentro de este grupo ya que consigue por sí solo un porcentaje superior al 90%, tan solo un 1% de diferencia respecto al modelo que le suma los datos de todos los demás objetivos del juego.

* En segundo lugar, generaremos modelos relacionados con las selecciones de los jugadores. Esto son campeones (personajes que utilizarán durante la partida), bans (personajes que prohibes escoger al equipo contrario) y hechizos que escoge utilizar cada jugador (pequeñas funcionalidades específicas dentro de la partida).

  - Árbol de decisión según los personajes que utilizan en la partida los jugadores de ambos equipos:
  
```{r}
# ATENCIÓN. ESTE CHUNK PUEDE TARDAR VARIOS MINUTOS EN EJECUTAR!
tree_champs <- ctree(winner ~ t1_champ1Name + t1_champ2Name + t1_champ3Name + t1_champ4Name + t1_champ5Name + t2_champ1Name + t2_champ2Name + t2_champ3Name + t2_champ4Name + t2_champ5Name, data = df_games_dt_train) # Entrenamiento del modelo de árbol de decisión
predictions_champs <- predict(tree_champs, df_games_dt_test) # Predicciones sobre el conjunto de pruebas

mean(predictions_champs == df_games_dt_test$winner) # Porcentaje de aciertos
```

  - Árbol de decisión según los campeones baneados por los jugadores de ambos equipos:
  
```{r}
# ATENCIÓN. ESTE CHUNK PUEDE TARDAR VARIOS MINUTOS EN EJECUTAR!
tree_bans <- ctree(winner ~ t1_banName1 + t1_banName2 + t1_banName3 + t1_banName4 + t1_banName5 + t2_banName1 + t2_banName2 + t2_banName3 + t2_banName4 + t2_banName5, data = df_games_dt_train) # Entrenamiento del modelo de árbol de decisión
predictions_bans <- predict(tree_bans, df_games_dt_test) # Predicciones sobre el conjunto de pruebas

mean(predictions_bans == df_games_dt_test$winner) # Porcentaje de aciertos
```

  - Árbol de decisión según los hechizos que utilizan en la partida los jugadores de ambos equipos:
  
```{r}
tree_summoners <- ctree(winner ~ t1_champ1_sumName1 + t1_champ1_sumName2 + t1_champ2_sumName1 + t1_champ2_sumName2 + t1_champ3_sumName1 + t1_champ3_sumName2 + t1_champ4_sumName1 + t1_champ4_sumName2 + t1_champ5_sumName1 + t1_champ5_sumName2 + t2_champ1_sumName1 + t2_champ1_sumName2 + t2_champ2_sumName1 + t2_champ2_sumName2 + t2_champ3_sumName1 + t2_champ3_sumName2 + t2_champ4_sumName1 + t2_champ4_sumName2 + t2_champ5_sumName1 + t2_champ5_sumName2, data = df_games_dt_train) # Entrenamiento del modelo de árbol de decisión
predictions_summoners <- predict(tree_summoners, df_games_dt_test) # Predicciones sobre el conjunto de pruebas

mean(predictions_summoners == df_games_dt_test$winner) # Porcentaje de aciertos
```

  - Árbol de decisión uniendo todo lo utilizado anteriormente: 
  
```{r}
# ATENCIÓN. ESTE CHUNK PUEDE TARDAR VARIOS MINUTOS EN EJECUTAR!
tree_selections <- ctree(winner ~ t1_champ1Name + t1_champ2Name + t1_champ3Name + t1_champ4Name + t1_champ5Name + t2_champ1Name + t2_champ2Name + t2_champ3Name + t2_champ4Name + t2_champ5Name + t1_banName1 + t1_banName2 + t1_banName3 + t1_banName4 + t1_banName5 + t2_banName1 + t2_banName2 + t2_banName3 + t2_banName4 + t2_banName5 + t1_champ1_sumName1 + t1_champ1_sumName2 + t1_champ2_sumName1 + t1_champ2_sumName2 + t1_champ3_sumName1 + t1_champ3_sumName2 + t1_champ4_sumName1 + t1_champ4_sumName2 + t1_champ5_sumName1 + t1_champ5_sumName2 + t2_champ1_sumName1 + t2_champ1_sumName2 + t2_champ2_sumName1 + t2_champ2_sumName2 + t2_champ3_sumName1 + t2_champ3_sumName2 + t2_champ4_sumName1 + t2_champ4_sumName2 + t2_champ5_sumName1 + t2_champ5_sumName2, data = df_games_dt_train) # Entrenamiento del modelo de árbol de decisión
predictions_selections <- predict(tree_selections, df_games_dt_test) # Predicciones sobre el conjunto de pruebas

mean(predictions_selections == df_games_dt_test$winner) # Porcentaje de aciertos
```

En este segundo subconjunto de modelos vemos cómo NO existe una gran relación entre sus datos y el ganador de la partida ya que el porcentaje de aciertos ronda el 50%, un porcentaje realmente bajo. Cabe destacar que el modelo basado en campeones escogidos por los jugadores destaca relativamente dentro de este grupo ya que consigue por sí solo un porcentaje superior al conseguido al unir todos los datos.

* En tercer lugar, generaremos un modelo a partir de todos los datos anteriores.

```{r}
# ATENCIÓN. ESTE CHUNK PUEDE TARDAR VARIOS MINUTOS EN EJECUTAR!
tree_all <- ctree(winner ~ firstBlood + firstTower + firstInhibitor + firstBaron + firstDragon + t1_baronKills + t2_baronKills + t1_dragonKills + t2_dragonKills + t1_champ1Name + t1_champ2Name + t1_champ3Name + t1_champ4Name + t1_champ5Name + t2_champ1Name + t2_champ2Name + t2_champ3Name + t2_champ4Name + t2_champ5Name + t1_banName1 + t1_banName2 + t1_banName3 + t1_banName4 + t1_banName5 + t2_banName1 + t2_banName2 + t2_banName3 + t2_banName4 + t2_banName5 + t1_champ1_sumName1 + t1_champ1_sumName2 + t1_champ2_sumName1 + t1_champ2_sumName2 + t1_champ3_sumName1 + t1_champ3_sumName2 + t1_champ4_sumName1 + t1_champ4_sumName2 + t1_champ5_sumName1 + t1_champ5_sumName2 + t2_champ1_sumName1 + t2_champ1_sumName2 + t2_champ2_sumName1 + t2_champ2_sumName2 + t2_champ3_sumName1 + t2_champ3_sumName2 + t2_champ4_sumName1 + t2_champ4_sumName2 + t2_champ5_sumName1 + t2_champ5_sumName2, data = df_games_dt_train) # Entrenamiento del modelo de árbol de decisión
predictions_all <- predict(tree_all, df_games_dt_test) # Predicciones sobre el conjunto de pruebas

mean(predictions_all == df_games_dt_test$winner) # Porcentaje de aciertos
```

Lamentablemente, no supone una mejora respecto a los datos de porcentajes mostrados anteriormente si no que lo empeora ligeramente.

* En último lugar, generaremos un modelo a partir de los datos que han conseguido mejores datos en los dos primeros subconjuntos: los datos de objetivos y los datos de los campeones utilizados en la partida.

```{r}
# ATENCIÓN. ESTE CHUNK PUEDE TARDAR VARIOS MINUTOS EN EJECUTAR!
tree_best <- ctree(winner ~ firstBlood + firstTower + firstInhibitor + firstBaron + firstDragon + t1_baronKills + t2_baronKills + t1_dragonKills + t2_dragonKills + t1_champ1Name + t1_champ2Name + t1_champ3Name + t1_champ4Name + t1_champ5Name + t2_champ1Name + t2_champ2Name + t2_champ3Name + t2_champ4Name + t2_champ5Name, data = df_games_dt_train) # Entrenamiento del modelo de árbol de decisión
predictions_best <- predict(tree_best, df_games_dt_test) # Predicciones sobre el conjunto de pruebas

mean(predictions_best == df_games_dt_test$winner) # Porcentaje de aciertos
```

Finalmente, obtenemos una sutil mejora para el porcentaje que obtuvimos anteriormente al utilizar únicamente los datos sobre objetivos. Si buscamos modelos más rápidos y que utilicen menos variables, podríamos optar por el anteriormente nombrado modelo construido a partir de los datos sobre objetivos (model_objectives) con un 91,81% de aciertos o incluso con el modelo construido a partir de los datos sobre estructuras (model_structures) con un 90,01% de aciertos.

# Histogramas comparativos (María)

* Como preprocesado, para esta parte eliminamos las columnas que no necesitamos:
  - Nombre de los campeones
  - Hechizos de los campeones
  - Baneos de cada equipo
```{r}

dfHist = df_games

#Primero elimino las columnas que no necesito.

#Delete champ names

dfHist$t1_champ1Name= NULL
dfHist$t1_champ2Name= NULL
dfHist$t1_champ3Name= NULL
dfHist$t1_champ4Name= NULL
dfHist$t1_champ5Name= NULL
dfHist$t2_champ1Name= NULL
dfHist$t2_champ2Name= NULL
dfHist$t2_champ3Name= NULL
dfHist$t2_champ4Name= NULL
dfHist$t2_champ5Name= NULL

#Delete the character's spells

#Delete team 1 spells
dfHist$t1_champ1_sumName1= NULL
dfHist$t1_champ1_sumName2= NULL

dfHist$t1_champ2_sumName1= NULL
dfHist$t1_champ2_sumName2= NULL

dfHist$t1_champ3_sumName1= NULL
dfHist$t1_champ3_sumName2= NULL

dfHist$t1_champ4_sumName1= NULL
dfHist$t1_champ4_sumName2= NULL

dfHist$t1_champ5_sumName1= NULL
dfHist$t1_champ5_sumName2= NULL

#Delete team 2 spells
dfHist$t2_champ1_sumName1= NULL
dfHist$t2_champ1_sumName2= NULL

dfHist$t2_champ2_sumName1= NULL
dfHist$t2_champ2_sumName2= NULL

dfHist$t2_champ3_sumName1= NULL
dfHist$t2_champ3_sumName2= NULL

dfHist$t2_champ4_sumName1= NULL
dfHist$t2_champ4_sumName2= NULL

dfHist$t2_champ5_sumName1= NULL
dfHist$t2_champ5_sumName2= NULL

#Delete the bans made

#Delete bans t1
dfHist$t1_banName1 = NULL
dfHist$t1_banName2 = NULL
dfHist$t1_banName3 = NULL
dfHist$t1_banName4 = NULL
dfHist$t1_banName5 = NULL

#Delete bans t2
dfHist$t2_banName1 = NULL
dfHist$t2_banName2 = NULL
dfHist$t2_banName3 = NULL
dfHist$t2_banName4 = NULL
dfHist$t2_banName5 = NULL

```

* A continuación, representamos en histogramas cuántas veces se han llevado ambos equipos el primer Heraldo y la primera torre.

```{r}

attach(dfHist)

# Represento en Histogramas cuántas veces se ha llevado el equipo azul
# el primer heraldo y la primera torre.

# View First Rift Herald
FRH<- ggplot(dfHist, aes(x = firstRiftHerald, fill = firstRiftHerald)) +
  geom_bar(colour="black") + geom_text(stat='count',aes(label=..count..),vjust=-0.25) +
  scale_fill_manual(values=c("#33CCFF","#D3D3D3","#FF6666")) +
  scale_y_continuous(name= "Games") +
  scale_x_discrete(name = "First Rift Herald", labels = c('Blue','None','Red'))
FRH

# View First Tower
FT<- ggplot(dfHist, aes(x = firstTower, fill = firstTower)) +
  geom_bar(colour="black") + geom_text(stat='count',aes(label=..count..),vjust=-0.25) +
  scale_fill_manual(values=c("#33CCFF","#D3D3D3","#FF6666")) +
  scale_y_continuous(name= "Games") +
  scale_x_discrete(name = "First Tower", labels = c('Blue','None','Red'))
FT

```

## Conclusión

* En cuanto al primer Heraldo, se puede observar que ambos equipos están igualados. El equipo azul se lo ha llevado más veces pero no hay mucha diferencia con el equipo rojo. Sí que se puede observar que muchas veces no se han hecho ninguno de los dos equipos el Heraldo, ya que este aparece en el minuto 8 y desaparece en el 19:45 aproximadamente, por lo que es muy habitual que en muchas partidas los equipos se centren en otros objetivos. También comentar que en los primeros minutos de vida del Heraldo es muy difícil que un solo jugador lo mate solo, por lo que necesita ayuda normalmente del top lane y/o mid lane, y dependiendo de cómo vaya cada línea dedicen hacerlo o no.
* En cuanto a la primera torre también están muy igualados, ya que la partida empieza con un 50% de probabilid cada uno. El equipo azul supera ligeramente al equipo rojo, posiblemente influenciado por el hecho de que el equipo azul se ha llevado algunas más veces el Heraldo que el equipo rojo.

# Relación entre tirar Primera Torre teniendo el Primer Heraldo

* A continuación pasamos a estudiar la relación entre hacer el primer Heraldo y llevarse la primera torre.

```{r}
# Probabilidad del quipo Azul de tirar primera torre
# si se hace al primer heraldo.
dfHist_heraldBLue <- dfHist[(dfHist$firstRiftHerald == "blue"),]
nrow(dfHist_heraldBLue)
dfHist_heraldTowerBLue <- dfHist_heraldBLue[!(dfHist_heraldBLue$firstTower != "blue"),]
nrow(dfHist_heraldTowerBLue)
p_firstTowerBLUE<- percent(((nrow(dfHist_heraldTowerBLue))/nrow(dfHist_heraldBLue)))
p_firstTowerBLUE

# Probabilidad del quipo Rojo de tirar primera torre
# si se hace al primer heraldo.
dfHist_heraldRed <- dfHist[(dfHist$firstRiftHerald == "red"),]
nrow(dfHist_heraldRed)
dfHist_heraldTowerRed <- dfHist_heraldRed[!(dfHist_heraldRed$firstTower != "red"),]
nrow(dfHist_heraldTowerRed)
p_firstTowerRED<- percent(((nrow(dfHist_heraldTowerRed))/nrow(dfHist_heraldRed)))
p_firstTowerRED

# Ahora al contrario

# Probabilidad del quipo Rojo de tirar primera torre
# si el equipo Azul se hace al primer heraldo.
dfHist_heraldBLue <- dfHist[(dfHist$firstRiftHerald == "blue"),]
nrow(dfHist_heraldBLue)
dfHist_heraldTowerEnemyR <- dfHist_heraldBLue[!(dfHist_heraldBLue$firstTower == "blue"),]
nrow(dfHist_heraldTowerRed)
p_firstTowerEnemyRed<- percent(((nrow(dfHist_heraldTowerEnemyR))/nrow(dfHist_heraldBLue)))
p_firstTowerEnemyRed

# Probabilidad del quipo Azul de tirar primera torre
# si el equipo Rojo se hace al primer heraldo.
dfHist_heraldRed <- dfHist[(dfHist$firstRiftHerald == "red"),]
nrow(dfHist_heraldRed)
dfHist_heraldTowerEnemyB <- dfHist_heraldRed[!(dfHist_heraldRed$firstTower == "red"),]
nrow(dfHist_heraldTowerRed)
p_firstTowerEnemyBlue<- percent(((nrow(dfHist_heraldTowerEnemyB))/nrow(dfHist_heraldRed)))
p_firstTowerEnemyBlue

# Convierto a tabla y dataframe
probX <- matrix(c (p_firstTowerBLUE, p_firstTowerRED, p_firstTowerEnemyRed, p_firstTowerEnemyBlue), ncol=4, nrow = 1, byrow=TRUE)
colnames(probX) <- c("First Tower Blue","First Tower Red","First Tower EnemyRed", "First Tower EnemyBlue")
rownames(probX) <- c("Probability")
probX <- as.table(probX)
probX

prob1 <- as.data.frame(probX)

cbp1 <- c("#33CCFF", "#FF6666", "#FF6666","#33CCFF")

Prob1_plot<- ggplot(prob1, aes(x=rownames(prob1), Freq)) + geom_bar(stat='identity', fill = cbp1, colour="black") +
  geom_text(aes(label = Freq, vjust = 3)) +
  scale_y_discrete(name="Probabilities") +
  scale_x_discrete(name = "Probab. of getting First Tower", labels = c('First Tower\nBlue Team','First Tower\nRed Team','First Tower\nEnemy (Red Team)','First Tower\nEnemy (Blue Team)')) +
  ggtitle("Probabilities % of getting First Tower")
Prob1_plot + theme(plot.title = element_text(color="Black", size=12, face="bold.italic"))

```
## CONCLUSIÓN 

* Aquí estamos estudiando la relación entre Hacer Primer Heraldo + Tirar Primera Torre. Como se puede observar en el gráfico, el hecho de llevarse el primer Heraldo es bastante importante, ya que la probabilidad de tirar la primera torre tras llevarse el Heraldo en el equipo azul es de un 72,6% y en el equipo rojo es de un 71,6%. Esto es debido a que una vez que se hace el primer heraldo, se busca ayudar en una línea para luego invocar a este y que cargue contra la estructura (en este caso la primera torre) ya que el equipo que se la lleve primero recibe un bonus de oro.
* También se ha representado en el gráfico la probabilidad de que un equipo se haga el Heraldo y que el contrario tire la torre. Por ejemplo, si el equipo azul hace el Heraldo, la probabilidad de que el equipo rojo tire la primera torre es de un 27,4%. Es un porcentaje pequeño, por lo que no es habitual que esto ocurra, aunque si es posible, ya que para hacer el Heraldo en los primeros minutos cuando aparece se suele necesitar ayuda de algún compañero y el equipo enemigo puede aprovechar para pushear una línea y conseguir la primera torre.


## Clústering (David)

* Queremos obtener los personajes que más se seleccionan en las partidas que duran menos tiempo. Es decir, los que suelen facilitar que la partida se acorte debido a que son buenos personajes. 

* Debemos limpiar las columnas que no necesitemos. Para ello nos quedamos solo con la duracion del juego y los personajes seleccionados ya que es la información que necesitamos para hacer un  heatmap donde el eje X corresponda con la duración de la partida y el eje Y con los personajes disponibles, siendo la tupla x,y en las partidas que han durado X cuántas veces se ha seleccionado el personaje Y.

* Necesitamos los nombres de los personajes en lugar del ID

```{r}
dfClus = dfClusName

```

* Quitamos los partidos por encima de 40 minutos. Esta decisión la he tomado al obtener una media de duración de la fuente https://www.leagueofgraphs.com/es/rankings/game-durations. He considerado que si el objetivo es observar los mejores personajes en partidas de corta duración, las partidas que superen la media en un 20-30% no son de nuestro interés para el estudio, pero evidentemente necesitamos partidas con una duración media o un poco larga a fin de tener una referencia comparativa.

```{r}
dfClus
dfClus <- dfClus[!(dfClus$gameDuration > 2400),]
```


* El tiempo viene dado en segundos, por lo que lo transformamos a minutos, redondeando a cero dígitos. 
```{r}
dfClus$gameDuration = round(dfClus$gameDuration/60, digits = 0)
```

* Eliminamos las columnas que no nos aportan información relevante para este proceso.
```{r}
dfClus$winner = NULL
dfClus$firstBlood = NULL
dfClus$firstTower = NULL
dfClus$firstInhibitor = NULL
dfClus$firstBaron= NULL
dfClus$firstDragon= NULL
dfClus$firstRiftHerald= NULL

dfClus$t1_towerKills = NULL
dfClus$t1_inhibitorKills = NULL
dfClus$t1_baronKills = NULL
dfClus$t1_dragonKills = NULL
dfClus$t1_riftHeraldKills = NULL

dfClus$t2_towerKills = NULL
dfClus$t2_inhibitorKills = NULL
dfClus$t2_baronKills = NULL
dfClus$t2_dragonKills = NULL
dfClus$t2_riftHeraldKills = NULL

#Columnas de hechizos de campeón

#Hechizos del equipo 1

dfClus$t1_champ1_sumName1= NULL
dfClus$t1_champ1_sumName2= NULL

dfClus$t1_champ2_sumName1= NULL
dfClus$t1_champ2_sumName2= NULL

dfClus$t1_champ3_sumName1= NULL
dfClus$t1_champ3_sumName2= NULL

dfClus$t1_champ4_sumName1= NULL
dfClus$t1_champ4_sumName2= NULL

dfClus$t1_champ5_sumName1= NULL
dfClus$t1_champ5_sumName2= NULL

#Hechizos del equipo 1
dfClus$t2_champ1_sumName1= NULL
dfClus$t2_champ1_sumName2= NULL

dfClus$t2_champ2_sumName1= NULL
dfClus$t2_champ2_sumName2= NULL

dfClus$t2_champ3_sumName1= NULL
dfClus$t2_champ3_sumName2= NULL

dfClus$t2_champ4_sumName1= NULL
dfClus$t2_champ4_sumName2= NULL

dfClus$t2_champ5_sumName1= NULL
dfClus$t2_champ5_sumName2= NULL

#Eliminamos las columnas de baneo
#Bans t1
dfClus$t1_banName1 = NULL
dfClus$t1_banName2 = NULL
dfClus$t1_banName3 = NULL
dfClus$t1_banName4 = NULL
dfClus$t1_banName5 = NULL

#Bans t2
dfClus$t2_banName1 = NULL
dfClus$t2_banName2 = NULL
dfClus$t2_banName3 = NULL
dfClus$t2_banName4 = NULL
dfClus$t2_banName5 = NULL
```

* Una vez tenemos únicamente los datos que nos interesan, usamos la funcion table() de R para hacer conteo y sumar todos los elementos ordenandolos en los ejes de abscisa x = tiempo y = nombre de personaje.

* Debido a la disposición de los datos tenemos que hacer este proceso de forma individual por cada columna y luego sumarlo.
```{r}
t1 = table(x=dfClus$gameDuration, y=dfClus$t1_champ1Name)
t2 = table(x=dfClus$gameDuration, y=dfClus$t1_champ2Name)
t3 = table(x=dfClus$gameDuration, y=dfClus$t1_champ3Name)
t4 = table(x=dfClus$gameDuration, y=dfClus$t1_champ4Name)
t5 = table(x=dfClus$gameDuration, y=dfClus$t1_champ5Name)

t6 = table(x=dfClus$gameDuration, y=dfClus$t2_champ1Name)
t7 = table(x=dfClus$gameDuration, y=dfClus$t2_champ2Name)
t8 = table(x=dfClus$gameDuration, y=dfClus$t2_champ3Name)
t9 = table(x=dfClus$gameDuration, y=dfClus$t2_champ4Name)
t10 = table(x=dfClus$gameDuration, y=dfClus$t2_champ5Name)

tt = t1+t2+t3+t4+t5+t6+t7+t8+t9+t10
tt
```

* Ahora este objeto lo tenemos que transformar en dataframe para trabajar con el.
```{r}
dt = as.data.frame(tt)
dt
```

* Debido a la cantidad de campeones que hay en el juego si realizamos un plot  la información será poco visible y no podremos distinguir a penas nada como vemos en el siguiente mapa de calor.
```{r}
ggplot(dt, aes(x = dt$x, y = dt$y, fill=dt$Freq)) +geom_tile() +
  scale_x_discrete(name = "Game Duration") +
  scale_y_discrete(name = "Champions") + 
  labs(fill = "Frequency")
```

* Para poner solución a esto vamos a aplicar un filtro. Eliminamos los campeones que hayan sido seleccionados menos de doscientas veces.
```{r}
best200 <- dt[!(dt$Freq < 200),]
best200
```

* Realizamos el plot para comprobar si se visualiza mejor. Vemos que hay cierta mejoría, pero aun es dificil discernir de forma clara qué campeones son mejores.
```{r}
pbest200 = ggplot(best200, aes(x = best200$x, y = best200$y, fill=best200$Freq)) +geom_tile() +
  scale_x_discrete(name = "Game Duration") +
  scale_y_discrete(name = "Champions")
pbest200 + labs(fill = "Frequency")
```

* Aplicamos un segundo filtro en el que eliminamos campeones que hayan sido seleccionado menos de cuatrocientas veces.
```{r}
best400 <- dt[!(dt$Freq < 400),]
best400
```

* En esta ocasión comprobamos que se visualiza mejor y se  puede obtener informacion clara sobre qué campeones son más seleccionados en partidas que duran poco tiempo.
```{r}
pbest400 = ggplot(best400, aes(x = best400$x, y = best400$y, fill=best400$Freq)) +geom_tile() +
  scale_x_discrete(name = "Game Duration") +
  scale_y_discrete(name = "Champions")
pbest400 + labs(fill = "Frequency")
```

* Conclusión: Para analizar estos datos se hace necesario conocer un poco la mecánica del juego ya que en el existen roles dentro de los personajes, y esos roles explican ciertas anomalías que pueden darse en los resultados obtenidos. Por ejemplo, podemos observar que hay dos personajes concretos que se son seleccionados mucho en partidas de duración corta hasta duración larga. Tristana es ADC (personaje a distancia que hace daño) y Thresh es support (personaje que da soporte, que ayuda al ADC en su linea). Los datos pertenecen a la S6 (2016) y durante esa season debido a las mecánicas del juego ese dúo tenia muy buena sinergia por lo que era muy usual encontrarlos juntos en la linea de bot. Este dato, como otros, nos demuestra que los datos obtenidos y las conclusiones que podamos sacar son relevantes. 

* Otro dato a tener en cuenta es que 7/12 de estos personajes son ADC. ¿Qué significa esto? Que se repitan tanto las mismas selecciones para el mismo rol quiere decir que para dicha posición hay personajes, en este caso siete, que son más apropiados para acortar la duración de la partida, mientras que las otras posiciones estan más abiertas a variar en la selección de personaje y esto no va a influir en la duración de la partida. Esto tiene sentido, puesto que, generalmente, quien lleva las riendas de la partida debido a que es quien hace más daño es precisamente el ADC, por lo tanto, el rol y el personaje adecuado afectan a la duración de la partida.

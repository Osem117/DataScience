---
title: "League of Legends Games"
output: html_notebook
---

## Instalación e importación de las librerías necesarias.

```{r}
#install.packages("plyr")
#install.packages("dplyr")
#install.packages("RJSONIO")
#install.packages("factoextra")

library(plyr)
library(dplyr)
library(RJSONIO)
library(ggplot2)
library(cluster)
library(factoextra)
library(ggplot2)

```

## Lectura de datasets.

* Cargamos los datos del fichero csv con la información sobre las partidas en la variable "lol".
* Cargamos los datos del fichero csv que contiene la correspondencia entre los nombres de los campeones y sus IDs en la variable "champions".
* Cargamos los datos del fichero JSON que contiene la correspondencia entre los nombres de los hechizos y sus IDs en la variable "summoners".

```{r}
# Lectura
lol <- read.csv("./lolData/games.csv")
champions <- read.csv("./lolData/champs.csv")
con <- file("./lolData/summoner_spell_info.json", "r")

# Conversión a data frames
df_summoners <- ldply(fromJSON(con), data.frame)
close(con)
df_games = data.frame(lol)
df_champs = data.frame(champions)
```

## Limpieza de datasets.

* Eliminar los atributos que no sean relevantes para nuestro análisis:

  Para el dataframe de partidas (df_games):
  - El ID de las partidas.
  - La temporada en la que se jugó la partida, ya que todos nuestros datos son de la temporada 9.
  - La fecha de inicio de la partida, que no es relevante en comparación con otros datos como la duración de la partida y además sabemos que todas las partidas se jugaron durante el mismo año ya que pertenecen a la misma temporada.


  Para el dataframe de hechizos (df_summonners):
  - Eliminamos todas las columnas excepto las que contienen el nombre del hechizo y su ID para poder realizar la transformación en el dataframe de partidas más adelante.

```{r}
# Dataframe de partidas
df_games$gameId <- NULL # ID de la partida
df_games$seasonId <- NULL # ID de la temporada en la que se juega la partida
df_games$creationTime <- NULL # Fecha de creación de la partida

# Dataframe de hechizos
df_summoners$.id <- NULL # ID (duplicado) del hechizo
df_summoners$summonerLevel <- NULL # Nivel en el que se desbloquea el hechizo para el jugador
df_summoners$key <- NULL # Nombre de la variable interna que representa al hechizo
df_summoners$description <- NULL # Descripción de la funcionalidad del hechizo dentro del juego
```

* Eliminar los ejemplos de partidas cuya duración es menor a 15 minutos. Esto quiere decir que la partida ha finalizado por razones fuera de lo normal, por ejemplo, que algún jugador no esté conectado:

```{r}
df_games <- df_games[!(df_games$gameDuration < 900),]
```

* Sustituir el orden numérico atribuido a los equipos (0, 1, 2) por una etiqueta que lo represente ("none", "blue", "red") en todas aquellos atributos cuyo valor sea uno de los dos equipos.

```{r}
# Ganador de la partida
df_games$winner[df_games$winner == "0"] <- "none"
df_games$winner[df_games$winner == "1"] <- "blue"
df_games$winner[df_games$winner == "2"] <- "red"

# Equipo que consigue eliminar a un jugador del equipo contrario primero (esto conlleva una recompensa extra dentro del juego)
df_games$firstBlood[df_games$firstBlood == "0"] <- "none"
df_games$firstBlood[df_games$firstBlood == "1"] <- "blue"
df_games$firstBlood[df_games$firstBlood == "2"] <- "red"

# Equipo que consigue derrumbar una torre del equipo contrario primero (esto conlleva una recompensa extra dentro del juego)
df_games$firstTower[df_games$firstTower == "0"] <- "none"
df_games$firstTower[df_games$firstTower == "1"] <- "blue"
df_games$firstTower[df_games$firstTower == "2"] <- "red"

# Equipo que consigue derrumbar un inhibidor del equipo contrario primero (los inhibidores se encuentran muy cerca de la estructura final que hay que derrumbar para terminar la partida)
df_games$firstInhibitor[df_games$firstInhibitor == "0"] <- "none"
df_games$firstInhibitor[df_games$firstInhibitor == "1"] <- "blue"
df_games$firstInhibitor[df_games$firstInhibitor == "2"] <- "red"

# Equipo que consigue eliminar primero al monstruo de la jungla denominado como Baron (este monstruo otorga una gran mejora de estadísticas al equipo que lo haya eliminado)
df_games$firstBaron[df_games$firstBaron == "0"] <- "none"
df_games$firstBaron[df_games$firstBaron == "1"] <- "blue"
df_games$firstBaron[df_games$firstBaron == "2"] <- "red"

# Equipo que consigue eliminar primero a alguno de los dragones que aparecen (estos monstruos otorgan pequeñas mejoras de estadísiticas al equipo que los haya eliminado)
df_games$firstDragon[df_games$firstDragon == "0"] <- "none"
df_games$firstDragon[df_games$firstDragon == "1"] <- "blue"
df_games$firstDragon[df_games$firstDragon == "2"] <- "red"

# Equipo que consigue eliminar al monstruo de la jungla denominado como Heraldo (solo aparece 1 durante la partida y ayuda al equipo que lo haya eliminado a derrumbar estructuras tales como torres e inhibidores)
df_games$firstRiftHerald[df_games$firstRiftHerald == "0"] <- "none"
df_games$firstRiftHerald[df_games$firstRiftHerald == "1"] <- "blue"
df_games$firstRiftHerald[df_games$firstRiftHerald == "2"] <- "red"
```

```{r}
#Para posterior manipulación de clustering sin cambiar id -> nombre
dfClus = df_games
```

* Sustituir el identificador numérico de los campeones seleccionados y baneados por cada uno de los jugadores de ambos equipos por el nombre del campeón en el juego:
  En este caso utilizamos los datos del dataframe de campeones (df_champs) para reemplazar los datos del dataframe de partidas (df_games). Para realizar cada uno de los reemplazos en cada una de las columnas del dataframe de partidas que lo requieren, renombramos la columna del dataframe de campeones que contiene el ID del campeón para que coincida con el nombre de la columna cuyos ID queremos reemplazar en el dataframe de partidas. Además, renombramos la columna del dataframe de campeones que contiene el nombre del campeón por el nombre que queramos que tenga dicha columna en el dataframe de partidas. A continuación, realizamos un left join de ambos datasets a través de la columna de IDs que queremos sustituir y que ahora se llama igual en ambos dataframes. De esta manera, añadirá una nueva columna con los nombres de los campeones a partir de su ID según los datos en el dataframe de campeones. Finalmente, eliminamos la anterior columna que contenía los IDs y queríamos sustituir.

```{r}
# Campeón utilizado por el jugador 1 del equipo azul
df_champs = rename(df_champs, t1_champ1id = 'id') # (1) Renombramos la columna de IDs del dataframe de campeones por el nombre de la columna que queremos sustituir en el dataframe de partidas
df_champs = rename(df_champs, t1_champ1Name = 'name') # (2) Renombramos la columna de nombres del dataframe de campeones por el nombre que queramos que tenga la nueva columna de nombres en el dataframe de partidas

df_games <- left_join(df_games, df_champs, by = 't1_champ1id') # (3) Realizamos un left join entre ambos datasets a través de la columna que ahora se llama igual en ambos dataframes y que queremos sustituir (columnas que contienen IDs). Esto resultará en la adición de una nueva columna nombrada como hayamos decidido en el paso 2 y que contiene el nombre de cada campeón según su ID.
df_games$t1_champ1id <- NULL # (4) Eliminamos la columna que contiene los IDs de los campeones que queríamos sustituir en un primer momento.

# Campeón utilizado por el jugador 2 del equipo azul
df_champs = rename(df_champs, t1_champ2id = 't1_champ1id')
df_champs = rename(df_champs, t1_champ2Name = 't1_champ1Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ2id')
df_games$t1_champ2id <- NULL

# Campeón utilizado por el jugador 3 del equipo azul
df_champs = rename(df_champs, t1_champ3id = 't1_champ2id')
df_champs = rename(df_champs, t1_champ3Name = 't1_champ2Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ3id')
df_games$t1_champ3id <- NULL

# Campeón utilizado por el jugador 4 del equipo azul
df_champs = rename(df_champs, t1_champ4id = 't1_champ3id')
df_champs = rename(df_champs, t1_champ4Name = 't1_champ3Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ4id')
df_games$t1_champ4id <- NULL

# Campeón utilizado por el jugador 5 del equipo azul
df_champs = rename(df_champs, t1_champ5id = 't1_champ4id')
df_champs = rename(df_champs, t1_champ5Name = 't1_champ4Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ5id')
df_games$t1_champ5id <- NULL

# Campeón baneado por el jugador 1 del equipo azul
df_champs = rename(df_champs, t1_ban1 = 't1_champ5id')
df_champs = rename(df_champs, t1_banName1 = 't1_champ5Name')

df_games <- left_join(df_games, df_champs, by = 't1_ban1')
df_games$t1_ban1 <- NULL

# Campeón baneado por el jugador 2 del equipo azul
df_champs = rename(df_champs, t1_ban2 = 't1_ban1')
df_champs = rename(df_champs, t1_banName2 = 't1_banName1')

df_games <- left_join(df_games, df_champs, by = 't1_ban2')
df_games$t1_ban2 <- NULL

# Campeón baneado por el jugador 3 del equipo azul
df_champs = rename(df_champs, t1_ban3 = 't1_ban2')
df_champs = rename(df_champs, t1_banName3 = 't1_banName2')

df_games <- left_join(df_games, df_champs, by = 't1_ban3')
df_games$t1_ban3 <- NULL

# Campeón baneado por el jugador 4 del equipo azul
df_champs = rename(df_champs, t1_ban4 = 't1_ban3')
df_champs = rename(df_champs, t1_banName4 = 't1_banName3')

df_games <- left_join(df_games, df_champs, by = 't1_ban4')
df_games$t1_ban4 <- NULL

# Campeón baneado por el jugador 5 del equipo azul
df_champs = rename(df_champs, t1_ban5 = 't1_ban4')
df_champs = rename(df_champs, t1_banName5 = 't1_banName4')

df_games <- left_join(df_games, df_champs, by = 't1_ban5')
df_games$t1_ban5 <- NULL

# Campeón utilizado por el jugador 1 del equipo rojo
df_champs = rename(df_champs, t2_champ1id = 't1_ban5')
df_champs = rename(df_champs, t2_champ1Name = 't1_banName5')

df_games <- left_join(df_games, df_champs, by = 't2_champ1id')
df_games$t2_champ1id <- NULL

# Campeón utilizado por el jugador 2 del equipo rojo
df_champs = rename(df_champs, t2_champ2id = 't2_champ1id')
df_champs = rename(df_champs, t2_champ2Name = 't2_champ1Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ2id')
df_games$t2_champ2id <- NULL

# Campeón utilizado por el jugador 3 del equipo rojo
df_champs = rename(df_champs, t2_champ3id = 't2_champ2id')
df_champs = rename(df_champs, t2_champ3Name = 't2_champ2Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ3id')
df_games$t2_champ3id <- NULL

# Campeón utilizado por el jugador 4 del equipo rojo
df_champs = rename(df_champs, t2_champ4id = 't2_champ3id')
df_champs = rename(df_champs, t2_champ4Name = 't2_champ3Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ4id')
df_games$t2_champ4id <- NULL

# Campeón utilizado por el jugador 5 del equipo rojo
df_champs = rename(df_champs, t2_champ5id = 't2_champ4id')
df_champs = rename(df_champs, t2_champ5Name = 't2_champ4Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ5id')
df_games$t2_champ5id <- NULL

# Campeón baneado por el jugador 1 del equipo rojo
df_champs = rename(df_champs, t2_ban1 = 't2_champ5id')
df_champs = rename(df_champs, t2_banName1 = 't2_champ5Name')

df_games <- left_join(df_games, df_champs, by = 't2_ban1')
df_games$t2_ban1 <- NULL

# Campeón baneado por el jugador 2 del equipo rojo
df_champs = rename(df_champs, t2_ban2 = 't2_ban1')
df_champs = rename(df_champs, t2_banName2 = 't2_banName1')

df_games <- left_join(df_games, df_champs, by = 't2_ban2')
df_games$t2_ban2 <- NULL

# Campeón baneado por el jugador 3 del equipo rojo
df_champs = rename(df_champs, t2_ban3 = 't2_ban2')
df_champs = rename(df_champs, t2_banName3 = 't2_banName2')

df_games <- left_join(df_games, df_champs, by = 't2_ban3')
df_games$t2_ban3 <- NULL

# Campeón baneado por el jugador 4 del equipo rojo
df_champs = rename(df_champs, t2_ban4 = 't2_ban3')
df_champs = rename(df_champs, t2_banName4 = 't2_banName3')

df_games <- left_join(df_games, df_champs, by = 't2_ban4')
df_games$t2_ban4 <- NULL

# Campeón baneado por el jugador 5 del equipo rojo
df_champs = rename(df_champs, t2_ban5 = 't2_ban4')
df_champs = rename(df_champs, t2_banName5 = 't2_banName4')

df_games <- left_join(df_games, df_champs, by = 't2_ban5')
df_games$t2_ban5 <- NULL
```

* Sustituir el identificador numérico de los dos hechizos que cada uno de los jugadores de ambos equipos usarán en la partida por el nombre del hechizo en el juego:
  Seguimos el mismo planteamiento que el paso anterior, esta vez para sustituir los IDs de los hechizos que utilizan los jugadores en el dataframe de partidas (df_games), mediante los datos en el dataset de hechizos (df_summoners). 

```{r}
# Hechizo principal utilizado por el jugador 1 del equipo azul
df_summoners = rename(df_summoners, t1_champ1_sum1 = 'id') # (1) Renombramos la columna de IDs del dataframe de hechizos por el nombre de la columna que queremos sustituir en el dataframe de partidas
df_summoners = rename(df_summoners, t1_champ1_sumName1 = 'name') # (2) Renombramos la columna de nombres del dataframe de hechizos por el nombre que queramos que tenga la nueva columna de nombres en el dataframe de partidas

df_games <- left_join(df_games, df_summoners, by = 't1_champ1_sum1') # (3) Realizamos un left join entre ambos datasets a través de la columna que ahora se llama igual en ambos dataframes y que queremos sustituir (columnas que contienen IDs). Esto resultará en la adición de una nueva columna nombrada como hayamos decidido en el paso 2 y que contiene el nombre de cada hechizo según su ID.
df_games$t1_champ1_sum1 <- NULL # (4) Eliminamos la columna que contiene los IDs de los hechizos que queríamos sustituir en un primer momento.

# Hechizo secundario utilizado por el jugador 1 del equipo azul
df_summoners = rename(df_summoners, t1_champ1_sum2 = 't1_champ1_sum1')
df_summoners = rename(df_summoners, t1_champ1_sumName2 = 't1_champ1_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ1_sum2')
df_games$t1_champ1_sum2 <- NULL

# Hechizo principal utilizado por el jugador 2 del equipo azul
df_summoners = rename(df_summoners, t1_champ2_sum1 = 't1_champ1_sum2')
df_summoners = rename(df_summoners, t1_champ2_sumName1 = 't1_champ1_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ2_sum1')
df_games$t1_champ2_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 2 del equipo azul
df_summoners = rename(df_summoners, t1_champ2_sum2 = 't1_champ2_sum1')
df_summoners = rename(df_summoners, t1_champ2_sumName2 = 't1_champ2_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ2_sum2')
df_games$t1_champ2_sum2 <- NULL

# Hechizo principal utilizado por el jugador 3 del equipo azul
df_summoners = rename(df_summoners, t1_champ3_sum1 = 't1_champ2_sum2')
df_summoners = rename(df_summoners, t1_champ3_sumName1 = 't1_champ2_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ3_sum1')
df_games$t1_champ3_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 3 del equipo azul
df_summoners = rename(df_summoners, t1_champ3_sum2 = 't1_champ3_sum1')
df_summoners = rename(df_summoners, t1_champ3_sumName2 = 't1_champ3_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ3_sum2')
df_games$t1_champ3_sum2 <- NULL

# Hechizo principal utilizado por el jugador 4 del equipo azul
df_summoners = rename(df_summoners, t1_champ4_sum1 = 't1_champ3_sum2')
df_summoners = rename(df_summoners, t1_champ4_sumName1 = 't1_champ3_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ4_sum1')
df_games$t1_champ4_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 4 del equipo azul
df_summoners = rename(df_summoners, t1_champ4_sum2 = 't1_champ4_sum1')
df_summoners = rename(df_summoners, t1_champ4_sumName2 = 't1_champ4_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ4_sum2')
df_games$t1_champ4_sum2 <- NULL

# Hechizo principal utilizado por el jugador 5 del equipo azul
df_summoners = rename(df_summoners, t1_champ5_sum1 = 't1_champ4_sum2')
df_summoners = rename(df_summoners, t1_champ5_sumName1 = 't1_champ4_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ5_sum1')
df_games$t1_champ5_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 5 del equipo azul
df_summoners = rename(df_summoners, t1_champ5_sum2 = 't1_champ5_sum1')
df_summoners = rename(df_summoners, t1_champ5_sumName2 = 't1_champ5_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ5_sum2')
df_games$t1_champ5_sum2 <- NULL

# Hechizo principal utilizado por el jugador 1 del equipo rojo
df_summoners = rename(df_summoners, t2_champ1_sum1 = 't1_champ5_sum2')
df_summoners = rename(df_summoners, t2_champ1_sumName1 = 't1_champ5_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ1_sum1')
df_games$t2_champ1_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 1 del equipo rojo
df_summoners = rename(df_summoners, t2_champ1_sum2 = 't2_champ1_sum1')
df_summoners = rename(df_summoners, t2_champ1_sumName2 = 't2_champ1_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ1_sum2')
df_games$t2_champ1_sum2 <- NULL

# Hechizo principal utilizado por el jugador 2 del equipo rojo
df_summoners = rename(df_summoners, t2_champ2_sum1 = 't2_champ1_sum2')
df_summoners = rename(df_summoners, t2_champ2_sumName1 = 't2_champ1_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ2_sum1')
df_games$t2_champ2_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 2 del equipo rojo
df_summoners = rename(df_summoners, t2_champ2_sum2 = 't2_champ2_sum1')
df_summoners = rename(df_summoners, t2_champ2_sumName2 = 't2_champ2_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ2_sum2')
df_games$t2_champ2_sum2 <- NULL

# Hechizo principal utilizado por el jugador 3 del equipo rojo
df_summoners = rename(df_summoners, t2_champ3_sum1 = 't2_champ2_sum2')
df_summoners = rename(df_summoners, t2_champ3_sumName1 = 't2_champ2_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ3_sum1')
df_games$t2_champ3_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 3 del equipo rojo
df_summoners = rename(df_summoners, t2_champ3_sum2 = 't2_champ3_sum1')
df_summoners = rename(df_summoners, t2_champ3_sumName2 = 't2_champ3_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ3_sum2')
df_games$t2_champ3_sum2 <- NULL

# Hechizo principal utilizado por el jugador 4 del equipo rojo
df_summoners = rename(df_summoners, t2_champ4_sum1 = 't2_champ3_sum2')
df_summoners = rename(df_summoners, t2_champ4_sumName1 = 't2_champ3_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ4_sum1')
df_games$t2_champ4_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 4 del equipo rojo
df_summoners = rename(df_summoners, t2_champ4_sum2 = 't2_champ4_sum1')
df_summoners = rename(df_summoners, t2_champ4_sumName2 = 't2_champ4_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ4_sum2')
df_games$t2_champ4_sum2 <- NULL

# Hechizo principal utilizado por el jugador 5 del equipo rojo
df_summoners = rename(df_summoners, t2_champ5_sum1 = 't2_champ4_sum2')
df_summoners = rename(df_summoners, t2_champ5_sumName1 = 't2_champ4_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ5_sum1')
df_games$t2_champ5_sum1 <- NULL

# Hechizo secundario utilizado por el jugador 5 del equipo rojo
df_summoners = rename(df_summoners, t2_champ5_sum2 = 't2_champ5_sum1')
df_summoners = rename(df_summoners, t2_champ5_sumName2 = 't2_champ5_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ5_sum2')
df_games$t2_champ5_sum2 <- NULL
```

```{r}
#Variables con los nombres en lugar de los ID 
dfClusName = df_games
dfAR = df_games
```

#Chunk arboles de decisión. (Alicia)
```{r}

```


#Histogramas comparativos (María)
```{r}

library(ggplot2)
library(scales)

dfHist = df_games

#Primero elimino las columnas que no necesito.

#Delete champ names

dfHist$t1_champ1Name= NULL
dfHist$t1_champ2Name= NULL
dfHist$t1_champ3Name= NULL
dfHist$t1_champ4Name= NULL
dfHist$t1_champ5Name= NULL
dfHist$t2_champ1Name= NULL
dfHist$t2_champ2Name= NULL
dfHist$t2_champ3Name= NULL
dfHist$t2_champ4Name= NULL
dfHist$t2_champ5Name= NULL

#Delete the character's spells

#Delete team 1 spells
dfHist$t1_champ1_sumName1= NULL
dfHist$t1_champ1_sumName2= NULL

dfHist$t1_champ2_sumName1= NULL
dfHist$t1_champ2_sumName2= NULL

dfHist$t1_champ3_sumName1= NULL
dfHist$t1_champ3_sumName2= NULL

dfHist$t1_champ4_sumName1= NULL
dfHist$t1_champ4_sumName2= NULL

dfHist$t1_champ5_sumName1= NULL
dfHist$t1_champ5_sumName2= NULL

#Delete team 2 spells
dfHist$t2_champ1_sumName1= NULL
dfHist$t2_champ1_sumName2= NULL

dfHist$t2_champ2_sumName1= NULL
dfHist$t2_champ2_sumName2= NULL

dfHist$t2_champ3_sumName1= NULL
dfHist$t2_champ3_sumName2= NULL

dfHist$t2_champ4_sumName1= NULL
dfHist$t2_champ4_sumName2= NULL

dfHist$t2_champ5_sumName1= NULL
dfHist$t2_champ5_sumName2= NULL

#Delete the bans made

#Delete bans t1
dfHist$t1_banName1 = NULL
dfHist$t1_banName2 = NULL
dfHist$t1_banName3 = NULL
dfHist$t1_banName4 = NULL
dfHist$t1_banName5 = NULL

#Delete bans t2
dfHist$t2_banName1 = NULL
dfHist$t2_banName2 = NULL
dfHist$t2_banName3 = NULL
dfHist$t2_banName4 = NULL
dfHist$t2_banName5 = NULL

```

```{r}

attach(dfHist)

# Represento en Histogramas cuántas veces se ha llevado el equipo azul
# el primer heraldo y la primera torre.

# View First Rift Herald

ggplot(dfHist, aes(x = firstRiftHerald, fill = firstRiftHerald)) +
  geom_bar() + geom_text(stat='count',aes(label=..count..),vjust=-0.25) +
  scale_fill_manual(values=c("#00BFC4","#D3D3D3","#F8766D")) +
  scale_y_continuous(name= "Games") +
  scale_x_discrete(name = "First Rift Herald", labels = c('Blue','None','Red'))
  
# View First Tower
  
ggplot(dfHist, aes(x = firstTower, fill = firstTower)) +
  geom_bar() + geom_text(stat='count',aes(label=..count..),vjust=-0.25) +
  scale_fill_manual(values=c("#00BFC4","#D3D3D3","#F8766D")) +
  scale_y_continuous(name= "Games") +
  scale_x_discrete(name = "First Tower", labels = c('Blue','None','Red'))

# Probabilidad del quipo azul de tirar primera torre
# si se hace al primer heraldo.

tableFT<- table(firstTower)
tableFRH<- table(firstRiftHerald)
table_RH_FT<- table(firstRiftHerald, firstTower)
p_firstTowerIfFRH<-percent(table_RH_FT[1,1]/ tableFT[1])
p_firstTowerIfFRH

# Probabilidad de tirar primera torre del equipo azul
# si nadie ha hecho el primer heraldo

table_RH_FT<- table(firstRiftHerald, firstTower)
p_firstTowerT1<-percent(table_RH_FT[2,1]/ tableFT[1])
p_firstTowerT1

# Probabilidad de tirar primera torre del equipo rojo
# si nadie ha hecho el primer heraldo

table_RH_FT<- table(firstRiftHerald, firstTower)
p_firstTowerT2<-percent(table_RH_FT[2,3]/ tableFT[3])
p_firstTowerT2

# Convierto a tabla y dataframe

probX <- matrix(c (36.4, 50, 49.2), ncol=3, nrow = 1, byrow=TRUE)
colnames(probX) <- c("p_firstTowerIfFRH","p_firstTowerT1","p_firstTowerT2")
rownames(probX) <- c("Probability")
probX <- as.table(probX)
probX

prob1 <- as.data.frame(probX)

Prob1_plot<- ggplot(prob1, aes(x=rownames(prob1), Freq)) + geom_bar(stat='identity', fill = "#FF6666", colour="black") +
  geom_text(aes(label = Freq, vjust = 3)) +
  scale_y_continuous(name= "Probabilities %") +
  scale_x_discrete(name = "First Tower with and witout Herald", labels = c('First Tower with First Herald','T1 First Tower withot Herald','T2 First Tower withot Herald')) +
  ggtitle("Probabilities % of getting First Tower")
Prob1_plot + theme(plot.title = element_text(color="Black", size=12, face="bold.italic"))

# CONCLUSIÓN: Aquí estamos estudiando la relación entre Hacer Primer Heraldo + Tirar Primera Torre. Como se puede observar en el gráfico, el hecho de hacer el primer heraldo no es muy relevante ya que nos da un 36,4% de probabilidad que el equipo azul tire la primera torre teniendo el primer heraldo. Esto se puede deber a que las partidas del dataset son de equipos "low rank" y no se interesan mucho por hacer objetivos, ya que teniendo el heraldo permite conseguir una ventaja a la hora de tirar torres, ventaja muy importante en el early game para superar al enemigo en oro. Después se puede observar que sin tener el Heraldo los dos equipos tienen casi la misma probabilidad de tirar la primera torre.

```


## Clústering (David)

* Queremos obtener los personajes que más se seleccionan en las partidas que duran menos tiempo. Es decir, los que suelen facilitar que la partida se acorte debido a que son buenos personajes. 

* Debemos limpiar las columnas que no necesitemos. Para ello nos quedamos solo con la duracion del juego y los personajes seleccionados ya que es la información que necesitamos para hacer un  heatmap donde el eje X corresponda con la duración de la partida y el eje Y con los personajes disponibles, siendo la tupla x,y en las partidas que han durado X cuántas veces se ha seleccionado el personaje Y.

* Necesitamos los nombres de los personajes en lugar del ID

```{r}
dfClus = dfClusName

```

* Quitamos los partidos por encima de 40 minutos. Esta decisión la he tomado al obtener una media de duración de la fuente https://www.leagueofgraphs.com/es/rankings/game-durations. He considerado que si el objetivo es observar los mejores personajes en partidas de corta duración, las partidas que superen la media en un 20-30% no son de nuestro interés para el estudio, pero evidentemente necesitamos partidas con una duración media o un poco larga a fin de tener una referencia comparativa.

```{r}
dfClus
dfClus <- dfClus[!(dfClus$gameDuration > 2400),]
```


* El tiempo viene dado en segundos, por lo que lo transformamos a minutos, redondeando a cero dígitos. 
```{r}
dfClus$gameDuration = round(dfClus$gameDuration/60, digits = 0)
```

* Eliminamos las columnas que no nos aportan información relevante para este proceso.
```{r}
dfClus$winner = NULL
dfClus$firstBlood = NULL
dfClus$firstTower = NULL
dfClus$firstInhibitor = NULL
dfClus$firstBaron= NULL
dfClus$firstDragon= NULL
dfClus$firstRiftHerald= NULL

dfClus$t1_towerKills = NULL
dfClus$t1_inhibitorKills = NULL
dfClus$t1_baronKills = NULL
dfClus$t1_dragonKills = NULL
dfClus$t1_riftHeraldKills = NULL

dfClus$t2_towerKills = NULL
dfClus$t2_inhibitorKills = NULL
dfClus$t2_baronKills = NULL
dfClus$t2_dragonKills = NULL
dfClus$t2_riftHeraldKills = NULL

#Columnas de hechizos de campeón

#Hechizos del equipo 1

dfClus$t1_champ1_sumName1= NULL
dfClus$t1_champ1_sumName2= NULL

dfClus$t1_champ2_sumName1= NULL
dfClus$t1_champ2_sumName2= NULL

dfClus$t1_champ3_sumName1= NULL
dfClus$t1_champ3_sumName2= NULL

dfClus$t1_champ4_sumName1= NULL
dfClus$t1_champ4_sumName2= NULL

dfClus$t1_champ5_sumName1= NULL
dfClus$t1_champ5_sumName2= NULL

#Hechizos del equipo 1
dfClus$t2_champ1_sumName1= NULL
dfClus$t2_champ1_sumName2= NULL

dfClus$t2_champ2_sumName1= NULL
dfClus$t2_champ2_sumName2= NULL

dfClus$t2_champ3_sumName1= NULL
dfClus$t2_champ3_sumName2= NULL

dfClus$t2_champ4_sumName1= NULL
dfClus$t2_champ4_sumName2= NULL

dfClus$t2_champ5_sumName1= NULL
dfClus$t2_champ5_sumName2= NULL

#Eliminamos las columnas de baneo
#Bans t1
dfClus$t1_banName1 = NULL
dfClus$t1_banName2 = NULL
dfClus$t1_banName3 = NULL
dfClus$t1_banName4 = NULL
dfClus$t1_banName5 = NULL

#Bans t2
dfClus$t2_banName1 = NULL
dfClus$t2_banName2 = NULL
dfClus$t2_banName3 = NULL
dfClus$t2_banName4 = NULL
dfClus$t2_banName5 = NULL
```

* Una vez tenemos únicamente los datos que nos interesan, usamos la funcion table() de R para hacer conteo y sumar todos los elementos ordenandolos en los ejes de abscisa x = tiempo y = nombre de personaje.

* Debido a la disposición de los datos tenemos que hacer este proceso de forma individual por cada columna y luego sumarlo.
```{r}
t1 = table(x=dfClus$gameDuration, y=dfClus$t1_champ1Name)
t2 = table(x=dfClus$gameDuration, y=dfClus$t1_champ2Name)
t3 = table(x=dfClus$gameDuration, y=dfClus$t1_champ3Name)
t4 = table(x=dfClus$gameDuration, y=dfClus$t1_champ4Name)
t5 = table(x=dfClus$gameDuration, y=dfClus$t1_champ5Name)

t6 = table(x=dfClus$gameDuration, y=dfClus$t2_champ1Name)
t7 = table(x=dfClus$gameDuration, y=dfClus$t2_champ2Name)
t8 = table(x=dfClus$gameDuration, y=dfClus$t2_champ3Name)
t9 = table(x=dfClus$gameDuration, y=dfClus$t2_champ4Name)
t10 = table(x=dfClus$gameDuration, y=dfClus$t2_champ5Name)

tt = t1+t2+t3+t4+t5+t6+t7+t8+t9+t10
tt
```

* Ahora este objeto lo tenemos que transformar en dataframe para trabajar con el.
```{r}
dt = as.data.frame(tt)
dt
```

* Debido a la cantidad de campeones que hay en el juego si realizamos un plot  la información será poco visible y no podremos distinguir a penas nada como vemos en el siguiente mapa de calor.
```{r}
ggplot(dt, aes(x = dt$x, y = dt$y, fill=dt$Freq)) +geom_tile()
```

* Para poner solución a esto vamos a aplicar un filtro. Eliminamos los campeones que hayan sido seleccionados menos de doscientas veces.
```{r}
best200 <- dt[!(dt$Freq < 200),]
best200
```

* Realizamos el plot para comprobar si se visualiza mejor. Vemos que hay cierta mejoría, pero aun es dificil discernir de forma clara qué campeones son mejores.
```{r}
pbest200 = ggplot(best200, aes(x = best200$x, y = best200$y, fill=best200$Freq)) +geom_tile()
pbest200
```

* Aplicamos un segundo filtro en el que eliminamos campeones que hayan sido seleccionado menos de cuatrocientas veces.
```{r}
best400 <- dt[!(dt$Freq < 400),]
best400
```

* En esta ocasión comprobamos que se visualiza mejor y se  puede obtener informacion clara sobre qué campeones son más seleccionados en partidas que duran poco tiempo.
```{r}
pbest400 = ggplot(best400, aes(x = best400$x, y = best400$y, fill=best400$Freq)) +geom_tile()
pbest400
```

* Conclusión: Para analizar estos datos se hace necesario conocer un poco la mecánica del juego ya que en el existen roles dentro de los personajes, y esos roles explican ciertas anomalías que pueden darse en los resultados obtenidos. Por ejemplo, podemos observar que hay dos personajes concretos que se son seleccionados mucho en partidas de duración corta hasta duración larga. Tristana es ADC (personaje a distancia que hace daño) y Thresh es support (personaje que da soporte, que ayuda al ADC en su linea). Los datos pertenecen a la S6 (2016) y durante esa season debido a las mecánicas del juego ese dúo tenia muy buena sinergia por lo que era muy usual encontrarlos juntos en la linea de bot. Este dato, como otros, nos demuestra que los datos obtenidos y las conclusiones que podamos sacar son relevantes. 

* Otro dato a tener en cuenta es que 7/12 de estos personajes son ADC. ¿Qué significa esto? Que se repitan tanto las mismas selecciones para el mismo rol quiere decir que para dicha posición hay personajes, en este caso siete, que son más apropiados para acortar la duración de la partida, mientras que las otras posiciones estan más abiertas a variar en la selección de personaje y esto no va a influir en la duración de la partida. Esto tiene sentido, puesto que, generalmente, quien lleva las riendas de la partida debido a que es quien hace más daño es precisamente el ADC, por lo tanto, el rol y el personaje adecuado afectan a la duración de la partida.

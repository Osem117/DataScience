---
title: "League of Legends Games"
output: html_notebook
---

## Instalación e importación de las librerías necesarias.

```{r}

#install.packages("RJSONIO")
#install.packages("plyr")
#install.packages("dplyr")

library(plyr)
library(dplyr)
library(RJSONIO)

```

## Lectura de datasets.

* Cargamos los datos del fichero csv con la información sobre las partidas en la variable "lol".
* Cargamos los datos del fichero csv que contiene la correspondencia entre los nombres de los campeones y sus IDs en la variable "champions".
* Cargamos los datos del fichero JSON que contiene la correspondencia entre los nombres de los hechizos y sus IDs en la variable "summoners".

```{r}
# Lectura
lol <- read.csv("./lolData/games.csv")
champions <- read.csv("./lolData/champs.csv")
con <- file("./lolData/summoner_spell_info.json", "r")

# Conversión a data frames
df_summoners <- ldply(fromJSON(con), data.frame)
close(con)
df_games = data.frame(lol)
df_champs = data.frame(champions)
```

## Limpieza de datasets.

* Eliminar los atributos que no sean relevantes para nuestro análisis.
* Eliminar los ejemplos de partidas cuya duración es menor a 15 minutos. Esto quiere decir que la partida ha finalizado por razones fuera de lo normal, por ejemplo, que algún jugador no esté conectado.
* Sustituir el orden numérico atribuido a los equipos (0, 1, 2) por una etiqueta que lo represente ("none", "blue", "red").
* Sustituir el identificador numérico de los campeones seleccionados y baneados por cada uno de los jugadores de ambos equipos por el nombre del campeón en el juego.
* Sustituir el identificador numérico de los dos hechizos que cada uno de los jugadores de ambos equipos usarán en la partida por el nombre del hechizo en el juego.


```{r}
# Eliminamos las columnas irrelevantes
df_games$gameId <- NULL
df_games$seasonId <- NULL
df_games$creationTime <- NULL

df_summoners$.id <- NULL
df_summoners$summonerLevel <- NULL
df_summoners$key <- NULL
df_summoners$description <- NULL

df_games <- df_games[!(df_games$gameDuration < 900),]

df_games$winner[df_games$winner == "0"] <- "none"
df_games$winner[df_games$winner == "1"] <- "blue"
df_games$winner[df_games$winner == "2"] <- "red"

df_games$firstBlood[df_games$firstBlood == "0"] <- "none"
df_games$firstBlood[df_games$firstBlood == "1"] <- "blue"
df_games$firstBlood[df_games$firstBlood == "2"] <- "red"

df_games$firstTower[df_games$firstTower == "0"] <- "none"
df_games$firstTower[df_games$firstTower == "1"] <- "blue"
df_games$firstTower[df_games$firstTower == "2"] <- "red"

df_games$firstInhibitor[df_games$firstInhibitor == "0"] <- "none"
df_games$firstInhibitor[df_games$firstInhibitor == "1"] <- "blue"
df_games$firstInhibitor[df_games$firstInhibitor == "2"] <- "red"

df_games$firstBaron[df_games$firstBaron == "0"] <- "none"
df_games$firstBaron[df_games$firstBaron == "1"] <- "blue"
df_games$firstBaron[df_games$firstBaron == "2"] <- "red"

df_games$firstDragon[df_games$firstDragon == "0"] <- "none"
df_games$firstDragon[df_games$firstDragon == "1"] <- "blue"
df_games$firstDragon[df_games$firstDragon == "2"] <- "red"

df_games$firstRiftHerald[df_games$firstRiftHerald == "0"] <- "none"
df_games$firstRiftHerald[df_games$firstRiftHerald == "1"] <- "blue"
df_games$firstRiftHerald[df_games$firstRiftHerald == "2"] <- "red"


#Para posterior manipulación de clustering 
dfClusID = df_games

```

```{r}


df_champs = rename(df_champs, t1_champ1id = 'id')
df_champs = rename(df_champs, t1_champ1Name = 'name')

df_games <- left_join(df_games, df_champs, by = 't1_champ1id')
df_games$t1_champ1id <- NULL


df_champs = rename(df_champs, t1_champ2id = 't1_champ1id')
df_champs = rename(df_champs, t1_champ2Name = 't1_champ1Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ2id')
df_games$t1_champ2id <- NULL


df_champs = rename(df_champs, t1_champ3id = 't1_champ2id')
df_champs = rename(df_champs, t1_champ3Name = 't1_champ2Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ3id')
df_games$t1_champ3id <- NULL


df_champs = rename(df_champs, t1_champ4id = 't1_champ3id')
df_champs = rename(df_champs, t1_champ4Name = 't1_champ3Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ4id')
df_games$t1_champ4id <- NULL


df_champs = rename(df_champs, t1_champ5id = 't1_champ4id')
df_champs = rename(df_champs, t1_champ5Name = 't1_champ4Name')

df_games <- left_join(df_games, df_champs, by = 't1_champ5id')
df_games$t1_champ5id <- NULL


df_summoners = rename(df_summoners, t1_champ1_sum1 = 'id')
df_summoners = rename(df_summoners, t1_champ1_sumName1 = 'name')

df_games <- left_join(df_games, df_summoners, by = 't1_champ1_sum1')
df_games$t1_champ1_sum1 <- NULL


df_summoners = rename(df_summoners, t1_champ1_sum2 = 't1_champ1_sum1')
df_summoners = rename(df_summoners, t1_champ1_sumName2 = 't1_champ1_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ1_sum2')
df_games$t1_champ1_sum2 <- NULL


df_summoners = rename(df_summoners, t1_champ2_sum1 = 't1_champ1_sum2')
df_summoners = rename(df_summoners, t1_champ2_sumName1 = 't1_champ1_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ2_sum1')
df_games$t1_champ2_sum1 <- NULL


df_summoners = rename(df_summoners, t1_champ2_sum2 = 't1_champ2_sum1')
df_summoners = rename(df_summoners, t1_champ2_sumName2 = 't1_champ2_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ2_sum2')
df_games$t1_champ2_sum2 <- NULL


df_summoners = rename(df_summoners, t1_champ3_sum1 = 't1_champ2_sum2')
df_summoners = rename(df_summoners, t1_champ3_sumName1 = 't1_champ2_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ3_sum1')
df_games$t1_champ3_sum1 <- NULL


df_summoners = rename(df_summoners, t1_champ3_sum2 = 't1_champ3_sum1')
df_summoners = rename(df_summoners, t1_champ3_sumName2 = 't1_champ3_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ3_sum2')
df_games$t1_champ3_sum2 <- NULL


df_summoners = rename(df_summoners, t1_champ4_sum1 = 't1_champ3_sum2')
df_summoners = rename(df_summoners, t1_champ4_sumName1 = 't1_champ3_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ4_sum1')
df_games$t1_champ4_sum1 <- NULL


df_summoners = rename(df_summoners, t1_champ4_sum2 = 't1_champ4_sum1')
df_summoners = rename(df_summoners, t1_champ4_sumName2 = 't1_champ4_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ4_sum2')
df_games$t1_champ4_sum2 <- NULL


df_summoners = rename(df_summoners, t1_champ5_sum1 = 't1_champ4_sum2')
df_summoners = rename(df_summoners, t1_champ5_sumName1 = 't1_champ4_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't1_champ5_sum1')
df_games$t1_champ5_sum1 <- NULL


df_summoners = rename(df_summoners, t1_champ5_sum2 = 't1_champ5_sum1')
df_summoners = rename(df_summoners, t1_champ5_sumName2 = 't1_champ5_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't1_champ5_sum2')
df_games$t1_champ5_sum2 <- NULL


df_champs = rename(df_champs, t1_ban1 = 't1_champ5id')
df_champs = rename(df_champs, t1_banName1 = 't1_champ5Name')

df_games <- left_join(df_games, df_champs, by = 't1_ban1')
df_games$t1_ban1 <- NULL


df_champs = rename(df_champs, t1_ban2 = 't1_ban1')
df_champs = rename(df_champs, t1_banName2 = 't1_banName1')

df_games <- left_join(df_games, df_champs, by = 't1_ban2')
df_games$t1_ban2 <- NULL


df_champs = rename(df_champs, t1_ban3 = 't1_ban2')
df_champs = rename(df_champs, t1_banName3 = 't1_banName2')

df_games <- left_join(df_games, df_champs, by = 't1_ban3')
df_games$t1_ban3 <- NULL


df_champs = rename(df_champs, t1_ban4 = 't1_ban3')
df_champs = rename(df_champs, t1_banName4 = 't1_banName3')

df_games <- left_join(df_games, df_champs, by = 't1_ban4')
df_games$t1_ban4 <- NULL


df_champs = rename(df_champs, t1_ban5 = 't1_ban4')
df_champs = rename(df_champs, t1_banName5 = 't1_banName4')

df_games <- left_join(df_games, df_champs, by = 't1_ban5')
df_games$t1_ban5 <- NULL


df_champs = rename(df_champs, t2_champ1id = 't1_ban5')
df_champs = rename(df_champs, t2_champ1Name = 't1_banName5')

df_games <- left_join(df_games, df_champs, by = 't2_champ1id')
df_games$t2_champ1id <- NULL


df_champs = rename(df_champs, t2_champ2id = 't2_champ1id')
df_champs = rename(df_champs, t2_champ2Name = 't2_champ1Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ2id')
df_games$t2_champ2id <- NULL


df_champs = rename(df_champs, t2_champ3id = 't2_champ2id')
df_champs = rename(df_champs, t2_champ3Name = 't2_champ2Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ3id')
df_games$t2_champ3id <- NULL


df_champs = rename(df_champs, t2_champ4id = 't2_champ3id')
df_champs = rename(df_champs, t2_champ4Name = 't2_champ3Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ4id')
df_games$t2_champ4id <- NULL


df_champs = rename(df_champs, t2_champ5id = 't2_champ4id')
df_champs = rename(df_champs, t2_champ5Name = 't2_champ4Name')

df_games <- left_join(df_games, df_champs, by = 't2_champ5id')
df_games$t2_champ5id <- NULL


df_summoners = rename(df_summoners, t2_champ1_sum1 = 't1_champ5_sum2')
df_summoners = rename(df_summoners, t2_champ1_sumName1 = 't1_champ5_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ1_sum1')
df_games$t2_champ1_sum1 <- NULL


df_summoners = rename(df_summoners, t2_champ1_sum2 = 't2_champ1_sum1')
df_summoners = rename(df_summoners, t2_champ1_sumName2 = 't2_champ1_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ1_sum2')
df_games$t2_champ1_sum2 <- NULL


df_summoners = rename(df_summoners, t2_champ2_sum1 = 't2_champ1_sum2')
df_summoners = rename(df_summoners, t2_champ2_sumName1 = 't2_champ1_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ2_sum1')
df_games$t2_champ2_sum1 <- NULL


df_summoners = rename(df_summoners, t2_champ2_sum2 = 't2_champ2_sum1')
df_summoners = rename(df_summoners, t2_champ2_sumName2 = 't2_champ2_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ2_sum2')
df_games$t2_champ2_sum2 <- NULL


df_summoners = rename(df_summoners, t2_champ3_sum1 = 't2_champ2_sum2')
df_summoners = rename(df_summoners, t2_champ3_sumName1 = 't2_champ2_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ3_sum1')
df_games$t2_champ3_sum1 <- NULL


df_summoners = rename(df_summoners, t2_champ3_sum2 = 't2_champ3_sum1')
df_summoners = rename(df_summoners, t2_champ3_sumName2 = 't2_champ3_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ3_sum2')
df_games$t2_champ3_sum2 <- NULL


df_summoners = rename(df_summoners, t2_champ4_sum1 = 't2_champ3_sum2')
df_summoners = rename(df_summoners, t2_champ4_sumName1 = 't2_champ3_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ4_sum1')
df_games$t2_champ4_sum1 <- NULL


df_summoners = rename(df_summoners, t2_champ4_sum2 = 't2_champ4_sum1')
df_summoners = rename(df_summoners, t2_champ4_sumName2 = 't2_champ4_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ4_sum2')
df_games$t2_champ4_sum2 <- NULL


df_summoners = rename(df_summoners, t2_champ5_sum1 = 't2_champ4_sum2')
df_summoners = rename(df_summoners, t2_champ5_sumName1 = 't2_champ4_sumName2')

df_games <- left_join(df_games, df_summoners, by = 't2_champ5_sum1')
df_games$t2_champ5_sum1 <- NULL


df_summoners = rename(df_summoners, t2_champ5_sum2 = 't2_champ5_sum1')
df_summoners = rename(df_summoners, t2_champ5_sumName2 = 't2_champ5_sumName1')

df_games <- left_join(df_games, df_summoners, by = 't2_champ5_sum2')
df_games$t2_champ5_sum2 <- NULL


df_champs = rename(df_champs, t2_ban1 = 't2_champ5id')
df_champs = rename(df_champs, t2_banName1 = 't2_champ5Name')

df_games <- left_join(df_games, df_champs, by = 't2_ban1')
df_games$t2_ban1 <- NULL


df_champs = rename(df_champs, t2_ban2 = 't2_ban1')
df_champs = rename(df_champs, t2_banName2 = 't2_banName1')

df_games <- left_join(df_games, df_champs, by = 't2_ban2')
df_games$t2_ban2 <- NULL


df_champs = rename(df_champs, t2_ban3 = 't2_ban2')
df_champs = rename(df_champs, t2_banName3 = 't2_banName2')

df_games <- left_join(df_games, df_champs, by = 't2_ban3')
df_games$t2_ban3 <- NULL


df_champs = rename(df_champs, t2_ban4 = 't2_ban3')
df_champs = rename(df_champs, t2_banName4 = 't2_banName3')

df_games <- left_join(df_games, df_champs, by = 't2_ban4')
df_games$t2_ban4 <- NULL


df_champs = rename(df_champs, t2_ban5 = 't2_ban4')
df_champs = rename(df_champs, t2_banName5 = 't2_banName4')

df_games <- left_join(df_games, df_champs, by = 't2_ban5')
df_games$t2_ban5 <- NULL


#Variables con los nombres en lugar de los ID 
dfClusName = df_games
dfAR = df_games

```


#Chunk arboles de decisión. (Alicia)
```{r}

```


#Histogramas comparativos (María)
```{r}

library(ggplot2)

ggplot(df_games, aes(x = firstRiftHerald)) + 
  geom_bar(color = 'darkGray', fill = 'lightBlue') + 
  geom_text(stat='count',aes(label=..count..),vjust=-0.5)

```

```{r}

#View winning rates

ggplot(df_games, aes(x = winner, fill = winner)) +
  geom_bar() + geom_text(stat='count',aes(label=..count..),vjust=-0.5) +
  scale_fill_manual(values=c("#00BFC4", "#F8766D")) +
  scale_y_continuous(name= "Frequency") +
  scale_x_discrete(name = "Winning Team", labels = c('Blue','Red')) 
 
  
#View First Blood rates

ggplot(df_games, aes(x = firstBlood, fill = firstBlood)) +
  geom_bar() + geom_text(stat='count',aes(label=..count..),vjust=-0.5) +
  scale_fill_manual(values=c("#00BFC4","#F8766D")) +
  scale_y_continuous(name= "Frequency") +
  scale_x_discrete(name = "First Blood", labels = c('Blue','Red'))


#View First Rift Herald rates

ggplot(df_games, aes(x = firstRiftHerald, fill = firstRiftHerald)) +
  geom_bar() + geom_text(stat='count',aes(label=..count..),vjust=-0.5) +
  scale_fill_manual(values=c("#00BFC4","#D3D3D3","#F8766D")) +
  scale_y_continuous(name= "Frequency") +
  scale_x_discrete(name = "First Rift Herald", labels = c('Blue','None','Red'))

  
#View First Tower rates
  
ggplot(df_games, aes(x = firstTower, fill = firstTower)) +
  geom_bar() + geom_text(stat='count',aes(label=..count..),vjust=-0.5) +
  scale_fill_manual(values=c("#00BFC4","#D3D3D3","#F8766D")) +
  scale_y_continuous(name= "Frequency") +
  scale_x_discrete(name = "First Tower", labels = c('Blue','None','Red'))

```

```{r}

#Parte individual
#First Dragon

firstDragon <- ggplot(df_games, aes(firstDragon, fill = firstDragon  ) ) +
  geom_bar() + geom_text(stat='count',aes(label=..count..),vjust=-0.5) +
  scale_fill_manual(values=c("#00BFC4", "#D3D3D3", "#F8766D")) +
  scale_y_continuous(name= "Frequency") +
  scale_x_discrete(name = "First Dragon", labels = c('Blue','None','Red'))
  firstDragon + theme(legend.position="none")
  
```


#Clústering (David)
```{r}

# Primero limpiamos las columnas que no necesitamos para quedarnos solo 
#con la duracion del juego y los personajes seleccionados

dfClus$winner = NULL
dfClus$firstBlood = NULL
dfClus$firstTower = NULL
dfClus$firstInhibitor = NULL
dfClus$firstBaron= NULL
dfClus$firstDragon= NULL
dfClus$firstRiftHerald= NULL

#Delete the character's spells

#Delete team 1 spells
dfClus$t1_champ1_sum1= NULL
dfClus$t1_champ1_sum2= NULL

dfClus$t1_champ2_sum1= NULL
dfClus$t1_champ2_sum2= NULL

dfClus$t1_champ3_sum1= NULL
dfClus$t1_champ3_sum2= NULL

dfClus$t1_champ4_sum1= NULL
dfClus$t1_champ4_sum2= NULL

dfClus$t1_champ5_sum1= NULL
dfClus$t1_champ5_sum2= NULL

#Delete team 2 spells
dfClus$t2_champ1_sum1= NULL
dfClus$t2_champ1_sum2= NULL

dfClus$t2_champ2_sum1= NULL
dfClus$t2_champ2_sum2= NULL

dfClus$t2_champ3_sum1= NULL
dfClus$t2_champ3_sum2= NULL

dfClus$t2_champ4_sum1= NULL
dfClus$t2_champ4_sum2= NULL

dfClus$t2_champ5_sum1= NULL
dfClus$t2_champ5_sum2= NULL

#Delete the bans made

#Delete bans t1
dfClus$t1_ban1 = NULL
dfClus$t1_ban2 = NULL
dfClus$t1_ban3 = NULL
dfClus$t1_ban4 = NULL
dfClus$t1_ban5 = NULL

#Delete bans t2
dfClus$t2_ban1 = NULL
dfClus$t2_ban2 = NULL
dfClus$t2_ban3 = NULL
dfClus$t2_ban4 = NULL
dfClus$t2_ban5 = NULL

#Delete Dragon, Tower and baron kills per team
dfClus$t1_towerKills = NULL
dfClus$t1_inhibitorKills = NULL
dfClus$t1_baronKills = NULL
dfClus$t1_dragonKills = NULL
dfClus$t1_riftHeraldKills = NULL

dfClus$t2_towerKills = NULL
dfClus$t2_inhibitorKills = NULL
dfClus$t2_baronKills = NULL
dfClus$t2_dragonKills = NULL
dfClus$t2_riftHeraldKills = NULL

df = dfClus

#transformar el tiempo a minutos 
df$gameDuration = round(df$gameDuration/60, digits = 0)

#Contamos cuantas ocurrencias hay de cada uno
qTime = table(df$gameDuration)
qTime

#numero de campeones (tamaño de la Y)
qChamp = champions$id
count(champions, vars="id")




```
